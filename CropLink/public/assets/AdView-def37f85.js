import{d as z,s as E,y as J,a as f,u as K,h as g,o as Q,c as X,e as s,f as n,g as t,z as B,x as d,t as i,i as v,l as r,F as L,k as Z,q as ee,A as te,p as se,L as ae,B as oe,m as P,C as A,D as S,G as M,H as p,I as k,J as C,K as N,M as I}from"./index-3cbe3ae6.js";import{I as ne}from"./ImageCarousel-ca174611.js";const le={key:0,class:"grid grid-cols-2 gap-x-4 p-5"},ie={class:"w-full h-48 object-cover rounded-lg"},de={class:"text-xl font-semibold mb-2"},re={class:"text-sm mb-2"},ue=t("strong",null,"Status:",-1),ce={class:"text-sm mb-2"},ve=t("strong",null,"Id:",-1),_e={class:"text-sm mb-2"},me=t("strong",null,"Variety:",-1),fe={class:"text-sm mb-2"},ge=t("strong",null,"Yield Tonnage:",-1),pe={class:"text-sm mb-2"},he=t("strong",null,"Expected Harvest Date:",-1),be={class:"text-sm mb-2"},xe=t("strong",null,"Price:",-1),ye={key:0},Te={key:1},Ae={key:2},Se=t("p",null,"No bids yet",-1),ke=[Se],Ce={key:3},Ie={class:"bg-white p-4 rounded-lg shadow-md hover:shadow-lg transition duration-300 mb-4"},we={key:0,class:"flex flex-row space-x-4"},De={class:"text-sm text-green-400"},Ee={class:"flex flex-row space-x-4"},Be=t("label",{class:"block text-sm font-medium text-gray-700"},"Buyer",-1),Le={class:"text-sm"},Pe={class:"flex flex-row space-x-4"},Me=t("label",{class:"block text-sm font-medium text-gray-700"},"Offer",-1),Ne={class:"text-sm"},Ue={class:"flex flex-row space-x-4"},Oe=t("label",{class:"block text-sm font-medium text-gray-700"},"Time",-1),Ve={class:"text-sm"},$e={key:1,class:"flex flex-row justify-end"},je={key:1},He=t("p",null,"Ad not live yet",-1),We={key:1},Ge=z({__name:"AdView",props:{adId:{type:String,required:!0}},setup(U){const{modals:O}=E(J()),{profile:V}=E(f()),$=K(),x=f().BID_STATUSES,j=f().ACCOUNT_TYPES,y=f().AD_STATUSES,_=U,e=g({}),u=g([]),m=g(!1);let h;const H=async()=>{m.value=!0,e.value=await oe("ads",_.adId),e.value&&(e.value.live||e.value.status!=y.SOLD?(u.value=await P("bids","adId","==",_.adId,"status","==","pending",["createdAt","desc"],10),h=A(S(k(I,"bids"),p("adId","==",_.adId),p("status","==","pending"),M("createdAt","desc")),a=>{u.value=a.docs.map(o=>({id:o.id,...o.data()}))})):!e.value.live&&e.value.status==y.SOLD?(u.value=await P("bids","adId","==",_.adId,"status","==","accepted",["createdAt","desc"],10),h=A(S(k(I,"bids"),p("adId","==",_.adId),p("status","==","accepted"),M("createdAt","desc")),a=>{u.value=a.docs.map(o=>({id:o.id,...o.data()}))})):h=A(S(k(I,"ads"),p("id","==",_.adId)),a=>{e.value=a.docs.map(o=>(console.log("ad changed",o.data()),{id:o.id,...o.data()}))}),m.value=!1)},b=g(""),w=()=>{if(!e.value.biddingEndTime)return"";const a=C(e.value.biddingEndTime),o=Date.now(),c=a-o;if(c<0){b.value="Bidding has ended",clearInterval(D);return}let l=Math.floor(c/1e3%60),G=Math.floor(c/(1e3*60)%60),Y=Math.floor(c/(1e3*60*60)%24),R=Math.floor(c/(1e3*60*60*24));b.value=`${R} days ${Y} hours ${G} minutes ${l} seconds`},D=setInterval(w,1e3),W=()=>{O.value.addbid=!0};Q(async()=>{await H(),w()}),X(()=>{h(),clearInterval(D)});const T=g(!1),q=async a=>{a&&(T.value=!0,console.log("postAd",a),await f().postNewAd(a),T.value=!1)},F=a=>{console.log("contactWinner",a),$.push({name:"messaging",params:{adId:e.value.id}})};return(a,o)=>{var c;return s(),n(L,null,[e.value&&!m.value?(s(),n("div",le,[t("div",null,[t("div",ie,[e.value.images&&e.value.images.length>0?(s(),B(ne,{key:0,images:e.value.resizedImages},null,8,["images"])):d("",!0)]),t("h3",de,i(e.value.type),1),t("p",re,[ue,v(" "+i(e.value.status),1)]),t("p",ce,[ve,v(" "+i(e.value.id),1)]),t("p",_e,[me,v(" "+i(e.value.variety),1)]),t("p",fe,[ge,v(" "+i(e.value.yieldTonnage),1)]),t("p",pe,[he,v(" "+i(r(N)(e.value.expectedHarvestDate)?r(C)(e.value.expectedHarvestDate):e.value.expectedHarvestDate),1)]),t("p",be,[xe,v(" "+i(e.value.price),1)])]),e.value.live||e.value.status==r(y).SOLD?(s(),n("div",ye,[((c=r(V))==null?void 0:c.accountType)==r(j).BUYER?(s(),n("button",{key:0,onClick:W,class:"mt-2 mb-2 w-full inline-flex justify-center rounded-md border border-transparent bg-blue-100 px-4 py-2 text-sm font-medium text-blue-900 hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"},"Place a bid")):d("",!0),b.value?(s(),n("div",Te," Time left for bidding: "+i(b.value),1)):d("",!0),!u.value||u.value.length==0?(s(),n("span",Ae,ke)):d("",!0),u.value&&u.value.length>0?(s(),n("span",Ce,[(s(!0),n(L,null,Z(u.value,l=>(s(),n("div",Ie,[l.status==r(x).ACCEPTED?(s(),n("div",we,[t("p",De,i(l.status==r(x).ACCEPTED?"Winning Bid":l.status),1)])):d("",!0),t("div",Ee,[Be,t("p",Le,i(l.buyerId.substring(0,5)),1)]),t("div",Pe,[Me,t("p",Ne,i(l.price),1)]),t("div",Ue,[Oe,t("p",Ve,i(r(N)(l.createdAt)?r(C)(l.createdAt):l.createdAt),1)]),l.status==r(x).ACCEPTED?(s(),n("div",$e,[t("button",{onClick:F,class:"inline-flex justify-center rounded-md border border-transparent bg-green-100 px-4 py-2 text-sm font-medium text-green-900 hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"},"Contact")])):d("",!0)]))),256))])):d("",!0)])):(s(),n("div",je,[He,e.value.live?d("",!0):(s(),B(te,{key:0,disabled:e.value.live,isLoading:T.value,onClick:o[0]||(o[0]=l=>q(e.value.id)),class:"inline-flex justify-center rounded-md border border-transparent bg-green-100 px-4 py-2 text-sm font-medium text-green-900 hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"},{default:ee(()=>[v(" Post ")]),_:1},8,["disabled","isLoading"]))]))])):d("",!0),m.value?(s(),n("div",We,[se(ae,{isLoading:m.value},null,8,["isLoading"])])):d("",!0)],64)}}});export{Ge as default};
