import{d as N,s as R,a as T,h as i,o as $,c as j,e as o,f as a,F as w,k as A,g as n,w as F,v as q,x as v,p as z,L as U,ab as E,C as G,D as P,G as W,ac as M,M as I,ad as H,t as y,a9 as J,l as K,ae as O,af as Q,_ as X}from"./index-3cbe3ae6.js";const D=l=>(O("data-v-0d164699"),l=l(),Q(),l),Y={key:0,class:"p-4 max-w-lg mx-auto bg-white rounded-lg shadow-md flex flex-col space-y-4"},Z=D(()=>n("h1",{class:"text-xl font-semibold border-b pb-2"},"Messaging",-1)),ee={key:0,class:"flex flex-col space-y-2 overflow-y-auto max-h-96"},se={class:"break-words"},te={key:0,class:"flex justify-between mb-2"},oe={class:"text-sm font-medium"},ae={class:"text-sm font-medium"},ne={key:1,class:"flex justify-center items-center h-32"},re=D(()=>n("p",{class:"text-gray-500"},"No messages yet",-1)),le=[re],ce={class:"flex items-end space-x-2"},de={key:1},ue=N({__name:"MessagingView",props:{adId:{type:String,required:!1}},setup(l){const S=l,{user:m,profile:k}=R(T()),c=i(!1),f=i({}),r=i({}),d=i([]);let g;const C=async()=>{c.value=!0;const s=(await E("chatrooms","adId","==",S.adId))[0];s&&(f.value={...s},c.value=!1,g=G(P(M(I,`chatrooms/${s.id}/messages`),W("createdAt","asc")),e=>{d.value=e.docs.map(u=>({...u.data()}))}))};$(async()=>{await C()}),j(()=>{g&&g()});const x=i(!1),V=async()=>{if(x.value=!0,!f.value||!r.value.text||!m.value||!k.value)return;const t=M(I,"chatrooms",f.value.id,"messages");r.value.createdAt=new Date,r.value.senderId=m.value.uid,await H(t,r.value),x.value=!1},L=t=>{const s=new Date,e=t.toDate(),u=s.getTime()-e.getTime(),p=Math.floor(u/1e3),h=Math.floor(p/60),_=Math.floor(h/60),b=Math.floor(_/24);return b>0?`${b} days ago`:_>0?`${_} hours ago`:h>0?`${h} minutes ago`:p>0?`${p} seconds ago`:"just now"},B=t=>{if(t===0)return!0;const s=d.value[t-1],e=d.value[t];return s.senderId!==e.senderId};return(t,s)=>(o(),a(w,null,[f.value&&!c.value?(o(),a("div",Y,[Z,d.value.length>0?(o(),a("div",ee,[(o(!0),a(w,null,A(d.value,(e,u)=>(o(),a("span",se,[B(u)?(o(),a("div",te,[n("p",oe,y(e.senderId.substring(0,5))+" says:",1),n("p",ae,y(L(e.createdAt)),1)])):v("",!0),n("p",{class:J([e.senderId===K(m).value.uid?"bg-blue-100 ml-auto":"bg-gray-100","rounded-md p-2 inline-block"])},y(e.text),3)]))),256))])):(o(),a("div",ne,le)),n("span",ce,[F(n("textarea",{"onUpdate:modelValue":s[0]||(s[0]=e=>r.value.text=e),class:"w-full p-2 border rounded-md resize-none focus:border-blue-500 focus:ring-0",placeholder:"Type your message here...",rows:"1"},null,512),[[q,r.value.text]]),n("button",{onClick:V,class:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out"},"Send")])])):v("",!0),c.value?(o(),a("div",de,[z(U,{isLoading:c.value},null,8,["isLoading"])])):v("",!0)],64))}});const fe=X(ue,[["__scopeId","data-v-0d164699"]]);export{fe as default};
