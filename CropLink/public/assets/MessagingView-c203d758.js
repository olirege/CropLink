import{e as t,f as a,g as s,d as Y,s as Z,a as U,h as c,o as ee,c as se,l as f,F as $,k as j,p as _,L as S,x as z,w as B,v as V,ab as te,C as E,D as F,G as q,ac as L,M as v,H as ae,ad as oe,ae as D,af as I,t as A,a9 as G}from"./index-b9943d6b.js";function ne(w,p){return t(),a("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[s("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z","clip-rule":"evenodd"})])}function le(w,p){return t(),a("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[s("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z","clip-rule":"evenodd"})])}const re={class:"grid grid-cols-2 gap-x-4 p-2"},ce={key:0,class:"p-4 w-full mx-auto bg-white rounded-lg shadow-md flex flex-col space-y-4"},de=s("h1",{class:"text-xl font-semibold border-b pb-2"},"Messaging",-1),ie={key:0,class:"flex flex-col space-y-2 overflow-y-auto max-h-96"},ue={class:"break-words"},fe={key:0,class:"flex justify-between mb-2"},ve={class:"text-sm font-medium"},he={class:"text-sm font-medium"},me={key:1,class:"flex justify-center items-center h-32"},ge=s("p",{class:"text-gray-500"},"No messages yet",-1),_e=[ge],pe={key:2,class:"flex justify-center items-center h-32"},xe={class:"flex items-end space-x-2"},we={key:1},ye={key:2,class:"flex justify-center items-center h-32"},be=s("p",{class:"text-gray-500"},"No chatroom found",-1),Ce=[be],ke={class:"p-4 w-full mx-auto bg-white rounded-lg shadow-md flex flex-col space-y-4"},Me=s("h1",{class:"text-xl font-semibold border-b pb-2"},"Contract Draft",-1),Se={key:0},Le={class:"relative break-words"},De=["onUpdate:modelValue"],Ie={class:"flex space-x-1 absolute top-1 right-1"},Ae={key:1},Ne=s("p",null,"No clauses yet",-1),Re=[Ne],Te={key:2},$e=Y({__name:"MessagingView",props:{adId:{type:String,required:!1}},setup(w){const p=w,{user:h,profile:N}=Z(U()),m=c(!1),d=c(!1),g=c(!1),x=c({}),l=c({}),i=c({}),u=c([]),P=U().CLAUSE_STATUSES;let y,b;const H=async()=>{m.value=!0;const o=(await te("chatrooms","adId","==",p.adId))[0];o&&(x.value={...o},m.value=!1,y=E(F(L(v,`chatrooms/${o.id}/messages`),q("createdAt","asc")),e=>{d.value=!0,u.value=e.docs.map(r=>({...r.data()})),d.value=!1}),b=E(F(L(v,"contracts"),ae("adId","==",p.adId),q("createdAt","asc")),e=>{g.value=!0,l.value=e.docs.map(r=>({...r.data()})),g.value=!1}))};ee(async()=>{await H()}),se(()=>{y&&y(),b&&b()});const R=c(!1),W=async()=>{if(R.value=!0,!x.value||!i.value.text||!h.value||!N.value)return;const n=L(v,"chatrooms",x.value.id,"messages");i.value.createdAt=new Date,i.value.senderId=h.value.uid,await oe(n,i.value),R.value=!1},J=n=>{const o=new Date,e=n.toDate(),r=o.getTime()-e.getTime(),C=Math.floor(r/1e3),k=Math.floor(C/60),M=Math.floor(k/60),T=Math.floor(M/24);return T>0?`${T} days ago`:M>0?`${M} hours ago`:k>0?`${k} minutes ago`:C>0?`${C} seconds ago`:"just now"},K=n=>{if(n===0)return!0;const o=u.value[n-1],e=u.value[n];return o.senderId!==e.senderId},O=async()=>{const n=D(v,"contracts",l.value.id),o={id:Math.random().toString(36).substring(7),text:"",draft:!0,state:P.PENDING};await I(n,{clauses:[...l.value.clauses,o]},{merge:!0})},Q=async n=>{const o=D(v,"contracts",l.value.id);await I(o,{clauses:l.value.clauses.filter(e=>e.id!==n)},{merge:!0})},X=async n=>{const o=D(v,"contracts",l.value.id);await I(o,{clauses:l.value.clauses.map(e=>e.id===n?{...e,draft:!1}:e)},{merge:!0})};return(n,o)=>(t(),a("div",re,[x.value&&!m.value&&f(h)&&f(N)?(t(),a("div",ce,[de,u.value.length>0&&!d.value?(t(),a("div",ie,[(t(!0),a($,null,j(u.value,(e,r)=>(t(),a("span",ue,[K(r)?(t(),a("div",fe,[s("p",ve,A(e.senderId.substring(0,5))+" says:",1),s("p",he,A(J(e.createdAt)),1)])):z("",!0),s("div",{class:G([e.senderId!=f(h).uid?"justify-end":"justify-start","flex"])},[s("p",{class:G([e.senderId===f(h).uid?"bg-blue-500 text-white":"bg-gray-100","rounded-md p-2 max-w-xs md:max-w-md"])},A(e.text),3)],2)]))),256))])):u.value.length==0&&!d.value?(t(),a("div",me,_e)):d.value?(t(),a("div",pe,[_(S,{isLoading:d.value},null,8,["isLoading"])])):z("",!0),s("span",xe,[B(s("textarea",{"onUpdate:modelValue":o[0]||(o[0]=e=>i.value.text=e),class:"w-full p-2 border rounded-md resize-none focus:border-blue-500 focus:ring-0",placeholder:"Type your message here...",rows:"1"},null,512),[[V,i.value.text]]),s("button",{onClick:W,class:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md transition duration-300 ease-in-out"},"Send")])])):m.value?(t(),a("div",we,[_(S,{isLoading:m.value},null,8,["isLoading"])])):(t(),a("div",ye,Ce)),s("div",ke,[Me,s("button",{onClick:O},"Add Clause"),l.value&&l.value.clauses.length>0&&!g.value?(t(),a("div",Se,[(t(!0),a($,null,j(l.value.clauses,e=>(t(),a("div",Le,[B(s("textarea",{class:"w-full p-2 border rounded-md resize-none focus:border-blue-500 focus:ring-0","onUpdate:modelValue":r=>e.text=r},null,8,De),[[V,e.text]]),s("div",Ie,[_(f(le),{class:"h-5 w-5 text-red-400",onClick:r=>Q(e.id)},null,8,["onClick"]),_(f(ne),{class:"h-5 w-5 text-green-400",onClick:r=>X(e.id)},null,8,["onClick"])])]))),256))])):l.value&&l.value.clauses.length==0&&!g.value?(t(),a("div",Ae,Re)):(t(),a("div",Te,[_(S,{isLoading:g.value},null,8,["isLoading"])]))])]))}});export{$e as default};
