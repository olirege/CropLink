import{d as G,s as k,l as I,a as b,h as r,o as H,c as J,e as n,f as i,m as L,z as T,y as S,n as B,_ as K,x as u,g as m,t as W,F as N,k as X,p as Z,L as ee,a0 as se,q as x,i as O,a1 as R}from"./index-57eff0e8.js";import{_ as te}from"./SellerAdCard.vue_vue_type_script_setup_true_lang-1b627b9d.js";import{_ as ae}from"./BidCard.vue_vue_type_script_setup_true_lang-008bae11.js";import"./ImageCarousel-306bb4f4.js";import"./CheckCircleIcon-f7e2d9ba.js";const oe={key:0,class:"grid grid-cols-2 gap-x-4 p-5"},ne={key:0,class:"p-4"},ie={key:1},le=m("h3",{class:"text-xl font-semibold mb-2 capitalize"},"Time left",-1),de={class:"flex flex-row gap-2 items-center justify-center mb-2 rounded-md h-10 border-y"},re={class:"text-xl"},ue={key:2},ce=m("p",null,"No bids yet",-1),ve=[ce],_e={key:3},me={key:1},pe=m("p",null,"Ad not live yet",-1),fe={key:1},Se=G({__name:"AdView",props:{adId:{type:String,required:!0}},setup(P){const{modals:V,notifications:e}=k(I()),v=I().NOTIFICATION_TYPES,{profile:$}=k(b()),F=b().ACCOUNT_TYPES,w=b().AD_STATUSES,g=P,c=r([]),s=r({}),p=r(!1);let h,y;const U=r(!1),D=async()=>{const a="bids",o=[["adId","==",g.adId],["status","==",s.value.live||s.value.status!=w.SOLD?"pending":"accepted"]],t=["createdAt","desc"],{subscribe:l,unsubscribe:_}=R(a,o,t,d=>{c.value=d},d=>{e.value.show=!0,e.value.type=v.ERROR,e.value.message="Error loading bids, please try again later"},U,()=>{},()=>{},()=>{e.value.show=!0,e.value.type=v.SUCCESS,e.value.message="A new bid has been placed on your ad"});y=_,l()},M=async()=>{const a="ads",o=[["id","==",g.adId]],t=[],{subscribe:l,unsubscribe:_}=R(a,o,t,d=>{s.value=d[0],D()},d=>{e.value.show=!0,e.value.type=v.ERROR,e.value.message="Error loading ad, please try again later"},p);h=_,l()},f=r(""),A=()=>{if(!s.value.biddingEndTime)return"";const a=se(s.value.biddingEndTime),o=Date.now(),t=a-o;if(t<0){f.value="Bidding has ended",clearInterval(C);return}let l=Math.floor(t/1e3%60),_=Math.floor(t/(1e3*60)%60),d=Math.floor(t/(1e3*60*60)%24),Q=Math.floor(t/(1e3*60*60*24));f.value=`${Q} days ${d} hours ${_} minutes ${l} seconds`},C=setInterval(A,1e3),Y=()=>{V.value.addbid=!0};H(async()=>{await M(),await j(g.adId),A()}),J(()=>{y&&y(),h&&h(),clearInterval(C)});const E=r(!1),q=async a=>{if(!a)return;const{callFunction:o}=x("postAd",{adId:a},E,void 0,void 0,()=>{e.value.show=!0,e.value.type=v.SUCCESS,e.value.message="Ad is live!"},t=>{e.value.show=!0,e.value.type=v.ERROR,e.value.message="Error while posting ad, please try again later"});await o()},z=r(!1),j=async a=>{if(!a)return;const{callFunction:o}=x("increaseAdViewCount",{adId:a},z);await o()};return(a,o)=>{var t;return n(),i(N,null,[s.value&&!p.value?(n(),i("div",oe,[L(te,{ad:s.value,showButtons:!1},null,8,["ad"]),s.value.live||s.value.status==T(w).SOLD?(n(),i("div",ne,[((t=T($))==null?void 0:t.accountType)==T(F).BUYER?(n(),S(K,{key:0,onClick:Y},{default:B(()=>[O("Place a bid")]),_:1})):u("",!0),f.value?(n(),i("div",ie,[le,m("div",de,[m("p",re,W(f.value),1)])])):u("",!0),!c.value||c.value.length==0?(n(),i("span",ue,ve)):u("",!0),c.value&&c.value.length>0?(n(),i("span",_e,[(n(!0),i(N,null,X(c.value,l=>(n(),S(ae,{bid:l,showViewButton:!1,sellerId:s.value.uid},null,8,["bid","sellerId"]))),256))])):u("",!0)])):(n(),i("div",me,[pe,s.value.live?u("",!0):(n(),S(Z,{key:0,disabled:s.value.live,isLoading:E.value,onClick:o[0]||(o[0]=l=>q(s.value.id))},{default:B(()=>[O(" Post ")]),_:1},8,["disabled","isLoading"]))]))])):u("",!0),p.value?(n(),i("div",fe,[L(ee,{isLoading:p.value},null,8,["isLoading"])])):u("",!0)],64)}}});export{Se as default};
