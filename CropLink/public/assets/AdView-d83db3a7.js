import{d as U,s as w,y as Y,a as b,h as _,o as j,c as O,e as s,f as o,g as e,z as A,x as r,t as l,i as u,l as v,F as I,k as z,q as R,A as W,p as J,L as K,B as Q,m as X,C,D as B,G as Z,H as x,I as L,J as y,K as D,M as P}from"./index-edfb91c5.js";import{I as ee}from"./ImageCarousel-9965ea07.js";const te={key:0,class:"grid grid-cols-2 gap-x-4 p-5"},se={class:"w-full h-48 object-cover rounded-lg"},ae={class:"text-xl font-semibold mb-2"},oe={class:"text-sm mb-2"},ne=e("strong",null,"Id:",-1),le={class:"text-sm mb-2"},ie=e("strong",null,"Variety:",-1),de={class:"text-sm mb-2"},re=e("strong",null,"Yield Tonnage:",-1),ce={class:"text-sm mb-2"},ue=e("strong",null,"Expected Harvest Date:",-1),ve={class:"text-sm mb-2"},me=e("strong",null,"Price:",-1),_e={key:0},fe={key:1},ge={key:2},pe=e("p",null,"No bids yet",-1),he=[pe],be={key:3},xe={class:"bg-white p-4 rounded-lg shadow-md hover:shadow-lg transition duration-300 mb-4"},ye={class:"flex flex-row space-x-4"},ke=e("label",{class:"block text-sm font-medium text-gray-700"},"Buyer",-1),Te={class:"text-sm"},we={class:"flex flex-row space-x-4"},Ae=e("label",{class:"block text-sm font-medium text-gray-700"},"Offer",-1),Ie={class:"text-sm"},Ce={class:"flex flex-row space-x-4"},Be=e("label",{class:"block text-sm font-medium text-gray-700"},"Time",-1),Le={class:"text-sm"},De={key:1},Pe=e("p",null,"Ad not live yet",-1),Se={key:1},Ee=U({__name:"AdView",props:{adId:{type:String,required:!0}},setup(S){const{modals:M}=w(Y()),{profile:N}=w(b()),E=b().ACCOUNT_TYPES,f=S,t=_({}),c=_([]),m=_(!1);let p;const V=async()=>{m.value=!0,t.value=await Q("ads",f.adId),t.value&&(t.value.live?(c.value=await X("bids","adId","==",f.adId,"status","==","pending",["createdAt","desc"],10),p=C(B(L(P,"bids"),x("adId","==",f.adId),x("status","==","pending"),Z("createdAt","desc")),n=>{c.value=n.docs.map(a=>({id:a.id,...a.data()}))})):p=C(B(L(P,"ads"),x("id","==",f.adId)),n=>{t.value=n.docs.map(a=>(console.log("ad changed",a.data()),{id:a.id,...a.data()}))}),m.value=!1)},g=_(""),k=()=>{if(!t.value.biddingEndTime)return"";const n=y(t.value.biddingEndTime),a=Date.now(),i=n-a;if(i<0){g.value="Bidding has ended",clearInterval(T);return}let d=Math.floor(i/1e3%60),q=Math.floor(i/(1e3*60)%60),F=Math.floor(i/(1e3*60*60)%24),G=Math.floor(i/(1e3*60*60*24));g.value=`${G} days ${F} hours ${q} minutes ${d} seconds`},T=setInterval(k,1e3),$=()=>{M.value.addbid=!0};j(async()=>{await V(),k()}),O(()=>{p(),clearInterval(T)});const h=_(!1),H=async n=>{n&&(h.value=!0,console.log("postAd",n),await b().postNewAd(n),h.value=!1)};return(n,a)=>{var i;return s(),o(I,null,[t.value&&!m.value?(s(),o("div",te,[e("div",null,[e("div",se,[t.value.images&&t.value.images.length>0?(s(),A(ee,{key:0,images:t.value.resizedImages},null,8,["images"])):r("",!0)]),e("h3",ae,l(t.value.type),1),e("p",oe,[ne,u(" "+l(t.value.id),1)]),e("p",le,[ie,u(" "+l(t.value.variety),1)]),e("p",de,[re,u(" "+l(t.value.yieldTonnage),1)]),e("p",ce,[ue,u(" "+l(v(D)(t.value.expectedHarvestDate)?v(y)(t.value.expectedHarvestDate):t.value.expectedHarvestDate),1)]),e("p",ve,[me,u(" "+l(t.value.price),1)])]),t.value.live?(s(),o("div",_e,[((i=v(N))==null?void 0:i.accountType)==v(E).BUYER?(s(),o("button",{key:0,onClick:$,class:"mt-2 mb-2 w-full inline-flex justify-center rounded-md border border-transparent bg-blue-100 px-4 py-2 text-sm font-medium text-blue-900 hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"},"Place a bid")):r("",!0),g.value?(s(),o("div",fe," Time left for bidding: "+l(g.value),1)):r("",!0),!c.value||c.value.length==0?(s(),o("span",ge,he)):r("",!0),c.value&&c.value.length>0?(s(),o("span",be,[(s(!0),o(I,null,z(c.value,d=>(s(),o("div",xe,[e("div",ye,[ke,e("p",Te,l(d.buyerId.substring(0,5)),1)]),e("div",we,[Ae,e("p",Ie,l(d.price),1)]),e("div",Ce,[Be,e("p",Le,l(v(D)(d.createdAt)?v(y)(d.createdAt):d.createdAt),1)])]))),256))])):r("",!0)])):(s(),o("div",De,[Pe,t.value.live?r("",!0):(s(),A(W,{key:0,disabled:t.value.live,isLoading:h.value,onClick:a[0]||(a[0]=d=>H(t.value.id)),class:"inline-flex justify-center rounded-md border border-transparent bg-green-100 px-4 py-2 text-sm font-medium text-green-900 hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"},{default:R(()=>[u(" Post ")]),_:1},8,["disabled","isLoading"]))]))])):r("",!0),m.value?(s(),o("div",Se,[J(K,{isLoading:m.value},null,8,["isLoading"])])):r("",!0)],64)}}});export{Ee as default};
