import{e as a,f as o,g as t,d as X,s as te,a as W,u as le,h as g,o as se,c as ae,l as n,F as Y,k as K,p as E,L as G,x as C,t as p,w as oe,v as ne,ac as de,G as z,H as q,I as Q,ad as x,M as y,i as re,a9 as U,ae as ie,V as ue,J as B,af as V,ag as T,ah as Z,ai as ce,aj as ve,z as fe,A as he,y as ee,ak as me}from"./index-bcedb34b.js";function _e(_,w){return a(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"})])}function pe(_,w){return a(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})])}function ge(_,w){return a(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})])}function xe(_,w){return a(),o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z","clip-rule":"evenodd"})])}function ye(_,w){return a(),o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z","clip-rule":"evenodd"})])}const Ce={key:0,class:"p-4 w-full mx-auto bg-white rounded-lg shadow-md flex flex-col space-y-4"},we=t("h1",{class:"text-xl font-semibold border-b pb-2"},"Messaging",-1),be={key:0,class:"flex flex-col space-y-2 overflow-y-auto h-full"},$e={class:"break-words"},ke={key:0,class:"flex justify-between mb-2"},Me={class:"text-sm font-medium"},Ee={class:"text-sm font-medium"},Ie={class:"flex flex-col space-y-1"},Le={key:0,class:"truncate bg-gray-100 rounded-md p-2 max-w-xs md:max-w-md text-xs rounded-md p-1 bg-slate-200"},De=t("span",{class:"font-bold"},"clause:",-1),Re={class:"italic"},Te={key:1,class:"flex justify-center items-center h-32"},Ae=t("p",{class:"text-gray-500"},"No messages yet",-1),Se=[Ae],Ne={key:2,class:"flex justify-center items-center h-32"},je={class:"flex items-end space-x-2"},Oe={class:"border rounded-md w-full p-2"},Pe={key:0,class:"relative w-full truncate bg-gray-100 rounded-md p-2 max-w-xs md:max-w-md text-xs rounded-md p-1 bg-slate-200"},Ue={class:"text-sm text-slate-500 truncate"},Be=t("span",{class:"font-bold"},"clause: ",-1),Ve={class:"italic"},ze={class:"h-full flex items-start"},qe={key:1,class:"flex justify-center items-center h-32"},Ge=t("p",{class:"text-gray-500"},"No chatroom found",-1),Fe=[Ge],He={key:2},Je=X({__name:"ChatRoomComponent",props:{clauseMentionned:{type:Object,default:{}},adId:{type:String,required:!0}},emits:["onRemoveMentionnedClause"],setup(_,{emit:w}){const N=w,v=_,{user:i,profile:c}=te(W()),j=le(),I="chatrooms",k="messages",e=g(!1),b=g(!1),M=g({}),f=g({}),d=g([]);let D;const O=async()=>{e.value=!0;const h=(await de(I,"adId","==",v.adId))[0];if(!h)throw new Error("Chatroom not found");M.value={...h},e.value=!1,D=z(q(x(y,`${I}/${h.id}/${k}`),Q("createdAt","asc")),r=>{b.value=!0,d.value=r.docs.map(R=>({...R.data()})),b.value=!1})};se(async()=>{try{await O()}catch(m){m.message=="Chatroom not found"&&j.push("/")}}),ae(()=>{D&&D()});const A=g(!1),F=async()=>{if(A.value=!0,!M.value||!f.value.text||!i.value||!c.value)return;const m=x(y,I,M.value.id,k);f.value.quote=v.clauseMentionned,f.value.createdAt=new Date,f.value.senderId=i.value.uid,await ie(m,f.value),f.value.text="",N("onRemoveMentionnedClause"),A.value=!1},H=m=>{const h=new Date,r=m.toDate(),R=h.getTime()-r.getTime(),P=Math.floor(R/1e3),s=Math.floor(P/60),u=Math.floor(s/60),$=Math.floor(u/24);return $>0?`${$} days ago`:u>0?`${u} hours ago`:s>0?`${s} minutes ago`:P>0?`${P} seconds ago`:"just now"},J=m=>{if(m===0)return!0;const h=d.value[m-1],r=d.value[m];return h.senderId!==r.senderId};return(m,h)=>M.value.id&&!e.value&&n(i)&&n(c)?(a(),o("div",Ce,[we,d.value.length>0&&!b.value?(a(),o("div",be,[(a(!0),o(Y,null,K(d.value,(r,R)=>(a(),o("span",$e,[J(R)?(a(),o("div",ke,[t("p",Me,p(r.senderId.substring(0,5))+" says:",1),t("p",Ee,p(H(r.createdAt)),1)])):C("",!0),t("div",{class:U([r.senderId!=n(i).uid?"justify-end":"justify-start","flex"])},[t("div",Ie,[r.quote&&r.quote.text?(a(),o("p",Le,[De,re(),t("span",Re,p(r.quote.text),1)])):C("",!0),t("p",{class:U([r.senderId===n(i).uid?"bg-blue-500 text-white":"bg-gray-100","rounded-md p-2 max-w-xs md:max-w-md",r.quote?"ml-2":""])},p(r.text),3)])],2)]))),256))])):d.value.length==0&&!b.value?(a(),o("div",Te,Se)):b.value?(a(),o("div",Ne,[E(G,{isLoading:b.value},null,8,["isLoading"])])):C("",!0),t("span",je,[t("div",Oe,[_.clauseMentionned.id?(a(),o("div",Pe,[E(n(ye),{class:"h-4 w-4 absolute top-1 right-1",onClick:h[0]||(h[0]=r=>m.$emit("onRemoveMentionnedClause"))}),t("p",Ue,[Be,t("span",Ve,p(_.clauseMentionned.text),1)])])):C("",!0),oe(t("textarea",{"onUpdate:modelValue":h[1]||(h[1]=r=>f.value.text=r),class:"h-full w-full resize-none focus:outline-none",placeholder:"Type your message here..."},null,512),[[ne,f.value.text]])]),t("div",ze,[E(n(_e),{onClick:F,class:"h-6 w-6 text-blue-500"})])])])):!M.value.id&&!e.value?(a(),o("div",qe,Fe)):(a(),o("div",He,[E(G,{isLoading:e.value},null,8,["isLoading"])]))}}),We={key:0,class:"p-4 w-full mx-auto bg-white rounded-lg shadow-md flex flex-col space-y-4"},Ye=t("h1",{class:"text-xl font-semibold border-b pb-2"},"Contract Draft",-1),Ke={key:0,class:"flex flex-col space-y-4"},Qe={key:0},Xe={class:"text-lg font-semibold border-b pb-2"},Ze={class:"flex flex-col space-y-2"},et={class:"relative break-words"},tt=["onUpdate:modelValue"],st={key:2,class:"w-full flex justify-between"},at=["onClick"],ot={class:"flex items-center space-x-1 absolute top-1 right-1"},nt={key:0},lt={class:"text-lg font-semibold border-b pb-2"},dt={class:"flex flex-col space-y-2"},rt={class:"relative break-words"},it={class:"w-full flex justify-between"},ut=["onClick"],ct={class:"flex space-x-2"},vt=["onClick"],ft=["onClick"],ht={class:"w-full flex justify-between"},mt={key:0,class:"text-xs"},_t={key:1,class:"text-xs"},pt={key:1},gt={key:1},xt=t("p",null,"No Contract Found",-1),yt=[xt],Ct={key:2},wt=X({__name:"ContractComponent",props:{adId:{type:String,required:!0}},emits:["onMentionClause"],setup(_,{emit:w}){const N=_,v="contracts",i="clauses",{user:c,profile:j}=te(W()),I=g(!1),k=g(!1),e=g({}),b=g([]),M=g([]),f=g({}),d=W().CLAUSE_STATUSES;let D,O,A;const F=ue(e,(s,u)=>{s.id&&(O=z(q(x(y,`${v}/${e.value.id}/${i}`),B("authorId","==",c.value.uid),Q("createdAt","asc")),$=>{k.value=!0,console.log("user clauses changed"),b.value=$.docs.map(S=>({...S.data()})),k.value=!1}),A=z(q(x(y,`${v}/${e.value.id}/${i}`),B("authorId","!=",c.value.uid),B("draft","==",!1)),$=>{k.value=!0,console.log("other clauses changed"),M.value=$.docs.map(S=>({...S.data()})),k.value=!1}))}),H=async()=>{const s=x(y,`${v}/${e.value.id}/${i}`),u={id:Math.random().toString(36).substring(7),text:"",draft:!0,state:d.PENDING,authorId:c.value.uid,createdAt:new Date,updatedAt:new Date};console.log("onAddClauseDraft",s,u.id),await V(T(s,u.id),u)},J=async s=>{if(console.log("onRemoveClause",s),!s||!e.value.id)return;const u=x(y,`${v}/${e.value.id}/${i}`);await me(T(u,s)),f.value.id==s&&(f.value={})},m=async s=>{if(console.log("onEditClause",s),!s||!e.value.id)return;const u=x(y,`${v}/${e.value.id}/${i}`);await V(T(u,s),{draft:!0},{merge:!0}),f.value.id==s&&(f.value={})},h=async(s,u)=>{if(console.log("onEditClause",s,u),!s||!e.value.id||!Object.values(d).includes(u))return;const $=x(y,`${v}/${e.value.id}/${i}`);await V(T($,s),{state:u},{merge:!0}),f.value.id==s&&(f.value={})},r=async s=>{if(console.log("onEditClause",s),!s||!e.value.id)return;s.draft=!1;const u=x(y,`${v}/${e.value.id}/${i}`);await V(T(u,s.id),s,{merge:!0})},R=async()=>{if(console.log(e.value),!e.value.id||!c.value.uid||e.value&&e.value.ready&&e.value.ready.includes(c.value.uid))return;console.log("onReadyToProceed",e.value.id,c.value.uid);const s=x(y,v);await Z(T(s,e.value.id),{ready:ce(c.value.uid)})},P=async()=>{if(!e.value.id||!c.value.uid||e.value&&e.value.ready&&!e.value.ready.includes(c.value.uid))return;console.log("onCancelReadyToProceed",e.value.id,c.value.uid);const s=x(y,v);await Z(T(s,e.value.id),{ready:ve(c.value.uid)})};return se(async()=>{D=z(q(x(y,v),B("adId","==",N.adId),Q("createdAt","asc")),s=>{I.value=!0,console.log("contract changed"),e.value=s.docs[0].data(),I.value=!1})}),ae(()=>{D&&D(),O&&O(),A&&A(),F()}),(s,u)=>{var $,S;return e.value.id&&!I.value?(a(),o("div",We,[Ye,t("div",null,[t("p",null,"Last Updated: "+p(n(fe)(e.value.updatedAt)?n(he)(e.value.updatedAt):e.value.updatedAt),1)]),t("button",{onClick:H,class:"w-full border-dashed border-2 border-sky-500 rounded-sm p-1"},"Add Clause"),k.value?(a(),o("div",pt,[E(G,{isLoading:k.value},null,8,["isLoading"])])):(a(),o("div",Ke,[t("span",null,[b.value&&b.value.length>0?(a(),o("span",Qe,[t("label",Xe,p(n(j)&&n(j).name?`${n(j).name}'s `:"Your ")+"clauses",1),t("span",Ze,[(a(!0),o(Y,null,K(b.value,l=>(a(),o("div",et,[l.draft?oe((a(),o("textarea",{key:0,class:"w-full p-2 border rounded-md resize-none focus:border-blue-500 focus:ring-0","onUpdate:modelValue":L=>l.text=L},null,8,tt)),[[ne,l.text]]):(a(),o("p",{key:1,class:U(["w-full p-2 border rounded-md",{"bg-gray-200":l.state==n(d).PENDING,"bg-green-200":l.state==n(d).ACCEPTED,"bg-red-200":l.state==n(d).REJECTED}])},p(l.text),3)),l.state!=n(d).PENDING?(a(),o("div",st,[l.draft?C("",!0):(a(),o("p",{key:0,class:"text-xs underline",onClick:L=>s.$emit("onMentionClause",l)},"Mention",8,at)),t("p",{class:U({"text-green-400 text-xs":l.state==n(d).ACCEPTED,"text-red-400 text-xs":l.state==n(d).REJECTED})},p(l.state),3)])):C("",!0),t("div",ot,[l.draft?(a(),ee(n(xe),{key:0,class:"h-5 w-5 text-green-400",onClick:L=>r(l)},null,8,["onClick"])):(a(),ee(n(pe),{key:1,class:"h-5 w-5 text-blue-400",onClick:L=>m(l.id)},null,8,["onClick"])),E(n(ge),{class:"h-5 w-5",onClick:L=>J(l.id)},null,8,["onClick"])])]))),256))])])):C("",!0)]),t("span",null,[M.value&&M.value.length>0?(a(),o("span",nt,[t("label",lt,p(n(c).name==e.value.sellerId?e.value.sellerId.substring(0,5):e.value.buyerId.substring(0,5))+"'s clauses",1),t("span",dt,[(a(!0),o(Y,null,K(M.value,l=>(a(),o("div",rt,[t("p",{class:U(["w-full p-2 border rounded-md",{"bg-gray-200":l.state==n(d).PENDING,"bg-green-200":l.state==n(d).ACCEPTED,"bg-red-200":l.state==n(d).REJECTED}])},p(l.text),3),t("div",it,[t("a",{class:"text-xs underline",onClick:L=>s.$emit("onMentionClause",l)},"Mention",8,ut),t("div",ct,[t("a",{class:"text-xs font-semibold text-green-400 underline decoration-green-400",onClick:L=>h(l.id,n(d).ACCEPTED)},"Approve",8,vt),t("a",{class:"text-xs font-semibold text-red-400 underline decoration-red-400",onClick:L=>h(l.id,n(d).REJECTED)},"Reject",8,ft)])])]))),256))])])):C("",!0)]),t("div",ht,[t("div",null,[($=e.value.ready)!=null&&$.includes(e.value.sellerId)?(a(),o("p",mt,p(e.value.sellerId.substring(0,5))+" is ready",1)):C("",!0),(S=e.value.ready)!=null&&S.includes(e.value.buyerId)?(a(),o("p",_t,p(e.value.buyerId.substring(0,5))+" is ready",1)):C("",!0)]),e.value.ready.includes(n(c).uid)?C("",!0):(a(),o("button",{key:0,onClick:R,class:"bg-blue-500 text-white px-4 h-8 rounded-md hover:bg-blue-400 transition duration-300 ease-in-out"},"Ready to Proceed ")),e.value.ready.includes(n(c).uid)?(a(),o("button",{key:1,onClick:P,class:"bg-red-500 text-white px-4 h-8 rounded-md hover:bg-red-400 transition duration-300 ease-in-out"},"Cancel ")):C("",!0)])]))])):!e.value.id&&!I.value?(a(),o("div",gt,yt)):(a(),o("div",Ct,[E(G,{isLoading:k.value},null,8,["isLoading"])]))}}}),bt={class:"grid grid-cols-2 gap-x-4 p-2"},kt=X({__name:"MessagingView",props:{adId:{type:String,required:!1}},setup(_){const w=g({}),N=i=>{!i||!i.id||i.draft||(w.value=i)},v=()=>{w.value={}};return(i,c)=>(a(),o("div",bt,[E(Je,{clauseMentionned:w.value,onOnRemoveMentionnedClause:v,adId:_.adId},null,8,["clauseMentionned","adId"]),E(wt,{adId:_.adId,onOnMentionClause:N},null,8,["adId"])]))}});export{kt as default};
