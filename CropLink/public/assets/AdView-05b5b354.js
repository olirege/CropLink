import{d as q,a as _,u as z,e as t,f as i,l as c,g as a,t as h,x as r,z as H,A as V,s as D,B as J,h as b,o as K,c as Q,p as L,y as C,q as P,F as M,k as X,C as Z,L as ee,D as te,m as N,G as k,H as w,I as U,J as g,K as $,i as O,M as B}from"./index-bcedb34b.js";import{_ as se,a as ae}from"./SellerAdCard.vue_vue_type_script_setup_true_lang-22851e1d.js";const oe={class:"bg-white p-4 rounded-lg shadow-md hover:shadow-lg transition duration-300 mb-4"},ne={key:0,class:"flex flex-row space-x-4"},ie={class:"text-sm text-green-400"},de={class:"flex flex-row space-x-4"},le=a("label",{class:"block text-sm font-medium text-gray-700"},"Buyer",-1),re={class:"text-sm"},ue={class:"flex flex-row space-x-4"},ce=a("label",{class:"block text-sm font-medium text-gray-700"},"Offer",-1),fe={class:"text-sm"},ve={class:"flex flex-row space-x-4"},me=a("label",{class:"block text-sm font-medium text-gray-700"},"Time",-1),be={class:"text-sm"},ge={key:1,class:"flex flex-row justify-end"},_e=q({__name:"BidCard",props:{bid:{type:Object,required:!0}},setup(o){const v=_().BID_STATUSES,T=z(),A=f=>{console.log("contactWinner",f),T.push({name:"messaging",params:{adId:f}})};return(f,d)=>(t(),i("div",oe,[o.bid.status==c(v).ACCEPTED?(t(),i("div",ne,[a("p",ie,h(o.bid.status==c(v).ACCEPTED?"Winning Bid":o.bid.status),1)])):r("",!0),a("div",de,[le,a("p",re,h(o.bid.buyerId.substring(0,5)),1)]),a("div",ue,[ce,a("p",fe,h(o.bid.price),1)]),a("div",ve,[me,a("p",be,h(c(H)(o.bid.createdAt)?c(V)(o.bid.createdAt):o.bid.createdAt),1)]),o.bid.status==c(v).ACCEPTED?(t(),i("div",ge,[a("button",{onClick:d[0]||(d[0]=e=>A(o.bid.adId)),class:"inline-flex justify-center rounded-md border border-transparent bg-green-100 px-4 py-2 text-sm font-medium text-green-900 hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"},"Contact")])):r("",!0)]))}}),he={key:0,class:"grid grid-cols-2 gap-x-4 p-5"},pe={key:0},xe={key:1},ye={key:2},Te=a("p",null,"No bids yet",-1),Ae=[Te],Se={key:3},Ce={key:1},ke=a("p",null,"Ad not live yet",-1),we={key:1},Ie=q({__name:"AdView",props:{adId:{type:String,required:!0}},setup(o){const{modals:v}=D(J()),{profile:T}=D(_()),A=_().ACCOUNT_TYPES,f=_().AD_STATUSES,d=o,e=b({}),l=b([]),m=b(!1);let p;const W=async()=>{m.value=!0,e.value=await te("ads",d.adId),e.value&&(e.value.live||e.value.status!=f.SOLD?(l.value=await N("bids","adId","==",d.adId,"status","==","pending",["createdAt","desc"],10),p=k(w($(B,"bids"),g("adId","==",d.adId),g("status","==","pending"),U("createdAt","desc")),n=>{l.value=n.docs.map(s=>({id:s.id,...s.data()}))})):!e.value.live&&e.value.status==f.SOLD?(l.value=await N("bids","adId","==",d.adId,"status","==","accepted",["createdAt","desc"],10),p=k(w($(B,"bids"),g("adId","==",d.adId),g("status","==","accepted"),U("createdAt","desc")),n=>{l.value=n.docs.map(s=>({id:s.id,...s.data()}))})):p=k(w($(B,"ads"),g("id","==",d.adId)),n=>{e.value=n.docs.map(s=>(console.log("ad changed",s.data()),{...s.data()}))}),m.value=!1)},x=b(""),I=()=>{if(!e.value.biddingEndTime)return"";const n=V(e.value.biddingEndTime),s=Date.now(),u=n-s;if(u<0){x.value="Bidding has ended",clearInterval(E);return}let y=Math.floor(u/1e3%60),G=Math.floor(u/(1e3*60)%60),R=Math.floor(u/(1e3*60*60)%24),Y=Math.floor(u/(1e3*60*60*24));x.value=`${Y} days ${R} hours ${G} minutes ${y} seconds`},E=setInterval(I,1e3),j=()=>{v.value.addbid=!0};K(async()=>{await W(),I()}),Q(()=>{p(),clearInterval(E)});const S=b(!1),F=async n=>{n&&(S.value=!0,console.log("postAd",n),await _().postNewAd(n),S.value=!1)};return(n,s)=>{var u;return t(),i(M,null,[e.value&&!m.value?(t(),i("div",he,[L(se,{ad:e.value,showButtons:!1},null,8,["ad"]),e.value.live||e.value.status==c(f).SOLD?(t(),i("div",pe,[((u=c(T))==null?void 0:u.accountType)==c(A).BUYER?(t(),C(ae,{key:0,onClick:j},{default:P(()=>[O("Place a bid")]),_:1})):r("",!0),x.value?(t(),i("div",xe," Time left for bidding: "+h(x.value),1)):r("",!0),!l.value||l.value.length==0?(t(),i("span",ye,Ae)):r("",!0),l.value&&l.value.length>0?(t(),i("span",Se,[(t(!0),i(M,null,X(l.value,y=>(t(),C(_e,{bid:y},null,8,["bid"]))),256))])):r("",!0)])):(t(),i("div",Ce,[ke,e.value.live?r("",!0):(t(),C(Z,{key:0,disabled:e.value.live,isLoading:S.value,onClick:s[0]||(s[0]=y=>F(e.value.id)),class:"inline-flex justify-center rounded-md border border-transparent bg-green-100 px-4 py-2 text-sm font-medium text-green-900 hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"},{default:P(()=>[O(" Post ")]),_:1},8,["disabled","isLoading"]))]))])):r("",!0),m.value?(t(),i("div",we,[L(ee,{isLoading:m.value},null,8,["isLoading"])])):r("",!0)],64)}}});export{Ie as default};
