import{d as R,s as L,x as W,a as _,h as u,o as j,c as z,e as s,f as n,l as w,y as h,q as b,m as B,_ as H,p as i,t as J,F as C,k as K,n as Q,L as X,g as $,H as Z,D as x,z as y,I as T,J as D,K as c,M as A,N as ee,i as N,B as S}from"./index-aa4b1524.js";import{_ as ae}from"./SellerAdCard.vue_vue_type_script_setup_true_lang-d2976f19.js";import{_ as te}from"./BidCard.vue_vue_type_script_setup_true_lang-abe72ac3.js";const se={key:0,class:"grid grid-cols-2 gap-x-4 p-5"},oe={key:0},ne={key:1},de={key:2},ie=$("p",null,"No bids yet",-1),le=[ie],re={key:3},ue={key:1},ce=$("p",null,"Ad not live yet",-1),ve={key:1},me=R({__name:"AdView",props:{adId:{type:String,required:!0}},setup(E){const{modals:M}=L(W()),{profile:P}=L(_()),U=_().ACCOUNT_TYPES,m=_().AD_STATUSES,l=E,o=u([]),e=u({}),r=u(!1);let v;const O=async()=>{r.value=!0,e.value=await Z("ads",l.adId),e.value&&(e.value.live||e.value.status!=m.SOLD?(o.value=await x("bids","adId","==",l.adId,"status","==","pending",["createdAt","desc"],10),v=y(T(A(S,"bids"),c("adId","==",l.adId),c("status","==","pending"),D("createdAt","desc")),t=>{o.value=t.docs.map(a=>({id:a.id,...a.data()}))})):!e.value.live&&e.value.status==m.SOLD?(o.value=await x("bids","adId","==",l.adId,"status","==","accepted",["createdAt","desc"],10),v=y(T(A(S,"bids"),c("adId","==",l.adId),c("status","==","accepted"),D("createdAt","desc")),t=>{o.value=t.docs.map(a=>({id:a.id,...a.data()}))})):v=y(T(A(S,"ads"),c("id","==",l.adId)),t=>{e.value=t.docs.map(a=>(console.log("ad changed",a.data()),{...a.data()}))}),r.value=!1)},f=u(""),k=()=>{if(!e.value.biddingEndTime)return"";const t=ee(e.value.biddingEndTime),a=Date.now(),d=t-a;if(d<0){f.value="Bidding has ended",clearInterval(I);return}let p=Math.floor(d/1e3%60),F=Math.floor(d/(1e3*60)%60),G=Math.floor(d/(1e3*60*60)%24),Y=Math.floor(d/(1e3*60*60*24));f.value=`${Y} days ${G} hours ${F} minutes ${p} seconds`},I=setInterval(k,1e3),V=()=>{M.value.addbid=!0};j(async()=>{await O(),k()}),z(()=>{v(),clearInterval(I)});const g=u(!1),q=async t=>{t&&(g.value=!0,console.log("postAd",t),await _().postNewAd(t),g.value=!1)};return(t,a)=>{var d;return s(),n(C,null,[e.value&&!r.value?(s(),n("div",se,[w(ae,{ad:e.value,showButtons:!1},null,8,["ad"]),e.value.live||e.value.status==h(m).SOLD?(s(),n("div",oe,[((d=h(P))==null?void 0:d.accountType)==h(U).BUYER?(s(),b(H,{key:0,onClick:V},{default:B(()=>[N("Place a bid")]),_:1})):i("",!0),f.value?(s(),n("div",ne," Time left for bidding: "+J(f.value),1)):i("",!0),!o.value||o.value.length==0?(s(),n("span",de,le)):i("",!0),o.value&&o.value.length>0?(s(),n("span",re,[(s(!0),n(C,null,K(o.value,p=>(s(),b(te,{bid:p},null,8,["bid"]))),256))])):i("",!0)])):(s(),n("div",ue,[ce,e.value.live?i("",!0):(s(),b(Q,{key:0,disabled:e.value.live,isLoading:g.value,onClick:a[0]||(a[0]=p=>q(e.value.id)),class:"inline-flex justify-center rounded-md border border-transparent bg-green-100 px-4 py-2 text-sm font-medium text-green-900 hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"},{default:B(()=>[N(" Post ")]),_:1},8,["disabled","isLoading"]))]))])):i("",!0),r.value?(s(),n("div",ve,[w(X,{isLoading:r.value},null,8,["isLoading"])])):i("",!0)],64)}}});export{me as default};
