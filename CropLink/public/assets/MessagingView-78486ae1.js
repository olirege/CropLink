import{e as s,f as o,g as t,d as Z,s as oe,a as Y,u as ue,h as x,o as ne,c as le,l as n,F as K,k as Q,p as M,L as F,x as p,t as g,w as de,v as re,ac as ie,G as q,H as G,I as X,ad as y,M as C,i as ce,a9 as B,ae as ve,V as fe,J as V,af as z,ag as A,ah as se,ai as he,aj as me,ak as _e,z as pe,A as ge,y as ae,al as xe}from"./index-a18e6c1a.js";function ye(_,w){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"})])}function Ce(_,w){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})])}function we(_,w){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})])}function be(_,w){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z","clip-rule":"evenodd"})])}function $e(_,w){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z","clip-rule":"evenodd"})])}const ke={key:0,class:"p-4 w-full mx-auto bg-white rounded-lg shadow-md flex flex-col space-y-4"},Me=t("h1",{class:"text-xl font-semibold border-b pb-2"},"Messaging",-1),Ie={key:0,class:"flex flex-col space-y-2 overflow-y-auto h-full"},Ee={class:"break-words"},Le={key:0,class:"flex justify-between mb-2"},De={class:"text-sm font-medium"},Re={class:"text-sm font-medium"},Te={class:"flex flex-col space-y-1"},Ae={key:0,class:"truncate bg-gray-100 rounded-md p-2 max-w-xs md:max-w-md text-xs rounded-md p-1 bg-slate-200"},Se=t("span",{class:"font-bold"},"clause:",-1),Ne={class:"italic"},je={key:1,class:"flex justify-center items-center h-32"},Oe=t("p",{class:"text-gray-500"},"No messages yet",-1),Pe=[Oe],Ue={key:2,class:"flex justify-center items-center h-32"},Be={class:"flex items-end space-x-2"},Ve={class:"border rounded-md w-full p-2"},ze={key:0,class:"relative w-full truncate bg-gray-100 rounded-md p-2 max-w-xs md:max-w-md text-xs rounded-md p-1 bg-slate-200"},qe={class:"text-sm text-slate-500 truncate"},Ge=t("span",{class:"font-bold"},"clause: ",-1),Fe={class:"italic"},He={class:"h-full flex items-start"},Je={key:1,class:"flex justify-center items-center h-32"},We=t("p",{class:"text-gray-500"},"No chatroom found",-1),Ye=[We],Ke={key:2},Qe=Z({__name:"ChatRoomComponent",props:{clauseMentionned:{type:Object,default:{}},adId:{type:String,required:!0}},emits:["onRemoveMentionnedClause"],setup(_,{emit:w}){const D=w,v=_,{user:u,profile:i}=oe(Y()),j=ue(),I="chatrooms",$="messages",e=x(!1),b=x(!1),k=x({}),f=x({}),d=x([]);let R;const O=async()=>{e.value=!0;const h=(await ie(I,"adId","==",v.adId))[0];if(!h)throw new Error("Chatroom not found");k.value={...h},e.value=!1,R=q(G(y(C,`${I}/${h.id}/${$}`),X("createdAt","asc")),r=>{b.value=!0,d.value=r.docs.map(T=>({...T.data()})),b.value=!1})};ne(async()=>{try{await O()}catch(m){m.message=="Chatroom not found"&&j.push("/")}}),le(()=>{R&&R()});const S=x(!1),H=async()=>{if(S.value=!0,!k.value||!f.value.text||!u.value||!i.value)return;const m=y(C,I,k.value.id,$);f.value.quote=v.clauseMentionned,f.value.createdAt=new Date,f.value.senderId=u.value.uid,await ve(m,f.value),f.value.text="",D("onRemoveMentionnedClause"),S.value=!1},J=m=>{const h=new Date,r=m.toDate(),T=h.getTime()-r.getTime(),P=Math.floor(T/1e3),U=Math.floor(P/60),a=Math.floor(U/60),c=Math.floor(a/24);return c>0?`${c} days ago`:a>0?`${a} hours ago`:U>0?`${U} minutes ago`:P>0?`${P} seconds ago`:"just now"},W=m=>{if(m===0)return!0;const h=d.value[m-1],r=d.value[m];return h.senderId!==r.senderId};return(m,h)=>k.value.id&&!e.value&&n(u)&&n(i)?(s(),o("div",ke,[Me,d.value.length>0&&!b.value?(s(),o("div",Ie,[(s(!0),o(K,null,Q(d.value,(r,T)=>(s(),o("span",Ee,[W(T)?(s(),o("div",Le,[t("p",De,g(r.senderId.substring(0,5))+" says:",1),t("p",Re,g(J(r.createdAt)),1)])):p("",!0),t("div",{class:B([r.senderId!=n(u).uid?"justify-end":"justify-start","flex"])},[t("div",Te,[r.quote&&r.quote.text?(s(),o("p",Ae,[Se,ce(),t("span",Ne,g(r.quote.text),1)])):p("",!0),t("p",{class:B([r.senderId===n(u).uid?"bg-blue-500 text-white":"bg-gray-100","rounded-md p-2 max-w-xs md:max-w-md",r.quote?"ml-2":""])},g(r.text),3)])],2)]))),256))])):d.value.length==0&&!b.value?(s(),o("div",je,Pe)):b.value?(s(),o("div",Ue,[M(F,{isLoading:b.value},null,8,["isLoading"])])):p("",!0),t("span",Be,[t("div",Ve,[_.clauseMentionned.id?(s(),o("div",ze,[M(n($e),{class:"h-4 w-4 absolute top-1 right-1",onClick:h[0]||(h[0]=r=>m.$emit("onRemoveMentionnedClause"))}),t("p",qe,[Ge,t("span",Fe,g(_.clauseMentionned.text),1)])])):p("",!0),de(t("textarea",{"onUpdate:modelValue":h[1]||(h[1]=r=>f.value.text=r),class:"h-full w-full resize-none focus:outline-none",placeholder:"Type your message here..."},null,512),[[re,f.value.text]])]),t("div",He,[M(n(ye),{onClick:H,class:"h-6 w-6 text-blue-500"})])])])):!k.value.id&&!e.value?(s(),o("div",Je,Ye)):(s(),o("div",Ke,[M(F,{isLoading:e.value},null,8,["isLoading"])]))}}),Xe={key:0,class:"p-4 w-full mx-auto bg-white rounded-lg shadow-md flex flex-col space-y-4"},Ze=t("h1",{class:"text-xl font-semibold border-b pb-2"},"Contract Draft",-1),et={key:0,class:"flex flex-col space-y-4"},tt={key:0},st={class:"text-lg font-semibold border-b pb-2"},at={class:"flex flex-col space-y-2"},ot={class:"relative break-words"},nt=["onUpdate:modelValue"],lt={key:2,class:"w-full flex justify-between"},dt=["onClick"],rt={class:"flex items-center space-x-1 absolute top-1 right-1"},ut={key:0},it={class:"text-lg font-semibold border-b pb-2"},ct={class:"flex flex-col space-y-2"},vt={class:"relative break-words"},ft={class:"w-full flex justify-between"},ht=["onClick"],mt={class:"flex space-x-2"},_t=["onClick"],pt=["onClick"],gt={class:"w-full flex justify-between"},xt={key:0,class:"text-xs"},yt={key:1,class:"text-xs"},Ct={key:1},wt={key:1},bt=t("p",null,"No Contract Found",-1),$t=[bt],kt={key:2},Mt=Z({__name:"ContractComponent",props:{adId:{type:String,required:!0}},emits:["onMentionClause"],setup(_,{emit:w}){const D=_,v="contracts",u="clauses",{user:i,profile:j}=oe(Y()),I=x(!1),$=x(!1),e=x({}),b=x([]),k=x([]),f=x({}),d=Y().CLAUSE_STATUSES;let R,O,S;const H=fe(e,(a,c)=>{a.id&&(O=q(G(y(C,`${v}/${e.value.id}/${u}`),V("authorId","==",i.value.uid),X("createdAt","asc")),E=>{$.value=!0,console.log("user clauses changed"),b.value=E.docs.map(N=>({...N.data()})),$.value=!1}),S=q(G(y(C,`${v}/${e.value.id}/${u}`),V("authorId","!=",i.value.uid),V("draft","==",!1)),E=>{$.value=!0,console.log("other clauses changed"),k.value=E.docs.map(N=>({...N.data()})),$.value=!1}))}),J=async()=>{const a=y(C,`${v}/${e.value.id}/${u}`),c={id:Math.random().toString(36).substring(7),text:"",draft:!0,state:d.PENDING,authorId:i.value.uid,createdAt:new Date,updatedAt:new Date};console.log("onAddClauseDraft",a,c.id),await z(A(a,c.id),c)},W=async a=>{if(console.log("onRemoveClause",a),!a||!e.value.id)return;const c=y(C,`${v}/${e.value.id}/${u}`);await xe(A(c,a)),f.value.id==a&&(f.value={})},m=async a=>{if(console.log("onEditClause",a),!a||!e.value.id)return;const c=y(C,`${v}/${e.value.id}/${u}`);await z(A(c,a),{draft:!0},{merge:!0}),f.value.id==a&&(f.value={})},h=async(a,c)=>{if(console.log("onEditClause",a,c),!a||!e.value.id||!Object.values(d).includes(c))return;const E=y(C,`${v}/${e.value.id}/${u}`);await z(A(E,a),{state:c},{merge:!0}),f.value.id==a&&(f.value={})},r=async a=>{if(console.log("onEditClause",a),!a||!e.value.id)return;a.draft=!1;const c=y(C,`${v}/${e.value.id}/${u}`);await z(A(c,a.id),a,{merge:!0})},T=async()=>{if(console.log(e.value),!e.value.id||!i.value.uid||e.value&&e.value.ready&&e.value.ready.includes(i.value.uid))return;console.log("onReadyToProceed",e.value.id,i.value.uid);const a=y(C,v);await se(A(a,e.value.id),{ready:he(i.value.uid)})},P=async()=>{if(!e.value.id||!i.value.uid||e.value&&e.value.ready&&!e.value.ready.includes(i.value.uid))return;console.log("onCancelReadyToProceed",e.value.id,i.value.uid);const a=y(C,v);await se(A(a,e.value.id),{ready:me(i.value.uid)})},U=()=>{D.adId&&_e.push({name:"banking",params:{adId:D.adId}})};return ne(async()=>{R=q(G(y(C,v),V("adId","==",D.adId),X("createdAt","asc")),a=>{I.value=!0,console.log("contract changed"),e.value=a.docs[0].data(),I.value=!1})}),le(()=>{R&&R(),O&&O(),S&&S(),H()}),(a,c)=>{var E,N,ee,te;return e.value.id&&!I.value?(s(),o("div",Xe,[Ze,t("div",null,[t("p",null,"Last Updated: "+g(n(pe)(e.value.updatedAt)?n(ge)(e.value.updatedAt):e.value.updatedAt),1)]),t("button",{onClick:J,class:"w-full border-dashed border-2 border-sky-500 rounded-sm p-1"},"Add Clause"),$.value?(s(),o("div",Ct,[M(F,{isLoading:$.value},null,8,["isLoading"])])):(s(),o("div",et,[t("span",null,[b.value&&b.value.length>0?(s(),o("span",tt,[t("label",st,g(n(j)&&n(j).name?`${n(j).name}'s `:"Your ")+"clauses",1),t("span",at,[(s(!0),o(K,null,Q(b.value,l=>(s(),o("div",ot,[l.draft?de((s(),o("textarea",{key:0,class:"w-full p-2 border rounded-md resize-none focus:border-blue-500 focus:ring-0","onUpdate:modelValue":L=>l.text=L},null,8,nt)),[[re,l.text]]):(s(),o("p",{key:1,class:B(["w-full p-2 border rounded-md",{"bg-gray-200":l.state==n(d).PENDING,"bg-green-200":l.state==n(d).ACCEPTED,"bg-red-200":l.state==n(d).REJECTED}])},g(l.text),3)),l.state!=n(d).PENDING?(s(),o("div",lt,[l.draft?p("",!0):(s(),o("p",{key:0,class:"text-xs underline",onClick:L=>a.$emit("onMentionClause",l)},"Mention",8,dt)),t("p",{class:B({"text-green-400 text-xs":l.state==n(d).ACCEPTED,"text-red-400 text-xs":l.state==n(d).REJECTED})},g(l.state),3)])):p("",!0),t("div",rt,[l.draft?(s(),ae(n(be),{key:0,class:"h-5 w-5 text-green-400",onClick:L=>r(l)},null,8,["onClick"])):(s(),ae(n(Ce),{key:1,class:"h-5 w-5 text-blue-400",onClick:L=>m(l.id)},null,8,["onClick"])),M(n(we),{class:"h-5 w-5",onClick:L=>W(l.id)},null,8,["onClick"])])]))),256))])])):p("",!0)]),t("span",null,[k.value&&k.value.length>0?(s(),o("span",ut,[t("label",it,g(n(i).name==e.value.sellerId?e.value.sellerId.substring(0,5):e.value.buyerId.substring(0,5))+"'s clauses",1),t("span",ct,[(s(!0),o(K,null,Q(k.value,l=>(s(),o("div",vt,[t("p",{class:B(["w-full p-2 border rounded-md",{"bg-gray-200":l.state==n(d).PENDING,"bg-green-200":l.state==n(d).ACCEPTED,"bg-red-200":l.state==n(d).REJECTED}])},g(l.text),3),t("div",ft,[t("a",{class:"text-xs underline",onClick:L=>a.$emit("onMentionClause",l)},"Mention",8,ht),t("div",mt,[t("a",{class:"text-xs font-semibold text-green-400 underline decoration-green-400",onClick:L=>h(l.id,n(d).ACCEPTED)},"Approve",8,_t),t("a",{class:"text-xs font-semibold text-red-400 underline decoration-red-400",onClick:L=>h(l.id,n(d).REJECTED)},"Reject",8,pt)])])]))),256))])])):p("",!0)]),t("div",gt,[t("div",null,[(E=e.value.ready)!=null&&E.includes(e.value.sellerId)?(s(),o("p",xt,g(e.value.sellerId.substring(0,5))+" is ready",1)):p("",!0),(N=e.value.ready)!=null&&N.includes(e.value.buyerId)?(s(),o("p",yt,g(e.value.buyerId.substring(0,5))+" is ready",1)):p("",!0)]),e.value.ready.includes(n(i).uid)?p("",!0):(s(),o("button",{key:0,onClick:T,class:"bg-blue-500 text-white px-4 h-8 rounded-md hover:bg-blue-400 transition duration-300 ease-in-out"},"Ready to Proceed ")),e.value.ready.includes(n(i).uid)?(s(),o("button",{key:1,onClick:P,class:"bg-red-500 text-white px-4 h-8 rounded-md hover:bg-red-400 transition duration-300 ease-in-out"},"Cancel ")):p("",!0)]),(ee=e.value.ready)!=null&&ee.includes(e.value.sellerId)&&((te=e.value.ready)!=null&&te.includes(e.value.buyerId))?(s(),o("button",{key:0,onClick:U,class:"bg-yellow-500 text-white px-4 h-8 rounded-md hover:bg-yellow-400 transition duration-300 ease-in-out"},"Proceed ")):p("",!0)]))])):!e.value.id&&!I.value?(s(),o("div",wt,$t)):(s(),o("div",kt,[M(F,{isLoading:$.value},null,8,["isLoading"])]))}}}),It={class:"grid grid-cols-2 gap-x-4 p-2"},Lt=Z({__name:"MessagingView",props:{adId:{type:String,required:!1}},setup(_){const w=x({}),D=u=>{!u||!u.id||u.draft||(w.value=u)},v=()=>{w.value={}};return(u,i)=>(s(),o("div",It,[M(Qe,{clauseMentionned:w.value,onOnRemoveMentionnedClause:v,adId:_.adId},null,8,["clauseMentionned","adId"]),M(Mt,{adId:_.adId,onOnMentionClause:D},null,8,["adId"])]))}});export{Lt as default};
