import{d as G,s as k,m as x,a as b,r as d,o as H,c as J,e as n,f as i,n as B,B as T,A as S,p as I,q as K,z as u,j as _,t as W,F as L,l as X,x as Z,L as ee,a2 as se,y as N,i as O,a3 as R}from"./index-9479e00e.js";import{_ as te}from"./SellerAdCard.vue_vue_type_script_setup_true_lang-af074a3e.js";import{_ as ae}from"./BidCard.vue_vue_type_script_setup_true_lang-78a4879f.js";import"./ImageCarousel-463d693b.js";import"./CheckCircleIcon-8b3224ab.js";const oe={key:0,class:"flex flex-col sm:grid sm:grid-cols-2 sm:gap-x-4 sm:p-4"},ne={key:0,class:"p-4"},ie={key:1},le=_("h3",{class:"text-xl font-semibold mb-2 capitalize"},"Time left",-1),re={class:"flex flex-row gap-2 items-center justify-center mb-2 rounded-md h-10 border-y"},de={class:"text-xl"},ue={key:2},ce=_("p",null,"No bids yet",-1),ve=[ce],me={key:3},_e={key:1},fe=_("p",null,"Ad not live yet",-1),pe={key:1},Se=G({__name:"AdView",props:{adId:{type:String,required:!0}},setup(P){const{modals:V,notifications:e}=k(x()),v=x().NOTIFICATION_TYPES,{profile:$}=k(b()),F=b().ACCOUNT_TYPES,w=b().AD_STATUSES,g=P,c=d([]),s=d({}),f=d(!1);let y,h;const U=d(!1),D=async()=>{const a="bids",o=[["adId","==",g.adId],["status","==",s.value.live||s.value.status!=w.SOLD?"pending":"accepted"]],t=["createdAt","desc"],{subscribe:l,unsubscribe:m}=R(a,o,t,r=>{c.value=r},r=>{e.value.show=!0,e.value.type=v.ERROR,e.value.message="Error loading bids, please try again later"},U,()=>{},()=>{},()=>{e.value.show=!0,e.value.type=v.SUCCESS,e.value.message="A new bid has been placed on your ad"});h=m,l()},M=async()=>{const a="ads",o=[["id","==",g.adId]],t=[],{subscribe:l,unsubscribe:m}=R(a,o,t,r=>{s.value=r[0],D()},r=>{e.value.show=!0,e.value.type=v.ERROR,e.value.message="Error loading ad, please try again later"},f);y=m,l()},p=d(""),A=()=>{if(!s.value.biddingEndTime)return"";const a=se(s.value.biddingEndTime),o=Date.now(),t=a-o;if(t<0){p.value="Bidding has ended",clearInterval(C);return}let l=Math.floor(t/1e3%60),m=Math.floor(t/(1e3*60)%60),r=Math.floor(t/(1e3*60*60)%24),Q=Math.floor(t/(1e3*60*60*24));p.value=`${Q} days ${r} hours ${m} minutes ${l} seconds`},C=setInterval(A,1e3),Y=()=>{V.value.addbid=!0};H(async()=>{await M(),await z(g.adId),A()}),J(()=>{h&&h(),y&&y(),clearInterval(C)});const E=d(!1),j=async a=>{if(!a)return;const{callFunction:o}=N("postAd",{adId:a},E,void 0,void 0,()=>{e.value.show=!0,e.value.type=v.SUCCESS,e.value.message="Ad is live!"},t=>{e.value.show=!0,e.value.type=v.ERROR,e.value.message="Error while posting ad, please try again later"});await o()},q=d(!1),z=async a=>{if(!a)return;const{callFunction:o}=N("increaseAdViewCount",{adId:a},q);await o()};return(a,o)=>{var t;return n(),i(L,null,[s.value&&!f.value?(n(),i("div",oe,[B(te,{ad:s.value,showButtons:!1},null,8,["ad"]),s.value.live||s.value.status==T(w).SOLD?(n(),i("div",ne,[((t=T($))==null?void 0:t.accountType)==T(F).BUYER?(n(),S(K,{key:0,onClick:Y},{default:I(()=>[O("Place a bid")]),_:1})):u("",!0),p.value?(n(),i("div",ie,[le,_("div",re,[_("p",de,W(p.value),1)])])):u("",!0),!c.value||c.value.length==0?(n(),i("span",ue,ve)):u("",!0),c.value&&c.value.length>0?(n(),i("span",me,[(n(!0),i(L,null,X(c.value,l=>(n(),S(ae,{bid:l,showViewButton:!1,sellerId:s.value.uid},null,8,["bid","sellerId"]))),256))])):u("",!0)])):(n(),i("div",_e,[fe,s.value.live?u("",!0):(n(),S(Z,{key:0,disabled:s.value.live,isLoading:E.value,onClick:o[0]||(o[0]=l=>j(s.value.id))},{default:I(()=>[O(" Post ")]),_:1},8,["disabled","isLoading"]))]))])):u("",!0),f.value?(n(),i("div",pe,[B(ee,{isLoading:f.value},null,8,["isLoading"])])):u("",!0)],64)}}});export{Se as default};
