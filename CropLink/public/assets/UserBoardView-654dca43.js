import{h as x,o as U,N as me,O as _,d as N,P as W,Q as we,R as ge,S as k,T as q,U as se,V as xe,W as J,X as Ae,F as M,Y as _e,Z as he,$ as ee,a0 as ne,a1 as Y,a2 as L,a3 as V,a4 as ke,a5 as Te,a6 as j,a7 as D,u as Ce,e as g,f as w,k as Q,g as s,p as S,t as y,i as A,l as b,K as z,J as K,z as R,q as E,A as G,x as F,a as O,s as le,y as Se,a8 as ae,C as oe,D as ie,G as ue,H as re,I as de,a9 as ce,L as ve,M as fe}from"./index-edfb91c5.js";import{I as Ee}from"./ImageCarousel-9965ea07.js";function pe(e,v){if(e)return e;let c=v??"button";if(typeof c=="string"&&c.toLowerCase()==="button")return"button"}function Pe(e,v){let c=x(pe(e.value.type,e.value.as));return U(()=>{c.value=pe(e.value.type,e.value.as)}),me(()=>{var f;c.value||_(v)&&_(v)instanceof HTMLButtonElement&&!((f=_(v))!=null&&f.hasAttribute("type"))&&(c.value="button")}),c}let Ie=N({props:{onFocus:{type:Function,required:!0}},setup(e){let v=x(!0);return()=>v.value?W(ge,{as:"button",type:"button",features:we.Focusable,onFocus(c){c.preventDefault();let f,i=50;function o(){var l;if(i--<=0){f&&cancelAnimationFrame(f);return}if((l=e.onFocus)!=null&&l.call(e)){v.value=!1,cancelAnimationFrame(f);return}f=requestAnimationFrame(o)}f=requestAnimationFrame(o)}}):null}});var Be=(e=>(e[e.Forwards=0]="Forwards",e[e.Backwards=1]="Backwards",e))(Be||{}),Le=(e=>(e[e.Less=-1]="Less",e[e.Equal=0]="Equal",e[e.Greater=1]="Greater",e))(Le||{});let ye=Symbol("TabsContext");function X(e){let v=ee(ye,null);if(v===null){let c=new Error(`<${e} /> is missing a parent <TabGroup /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(c,X),c}return v}let te=Symbol("TabsSSRContext"),De=N({name:"TabGroup",emits:{change:e=>!0},props:{as:{type:[Object,String],default:"template"},selectedIndex:{type:[Number],default:null},defaultIndex:{type:[Number],default:0},vertical:{type:[Boolean],default:!1},manual:{type:[Boolean],default:!1}},inheritAttrs:!1,setup(e,{slots:v,attrs:c,emit:f}){var i;let o=x((i=e.selectedIndex)!=null?i:e.defaultIndex),l=x([]),h=x([]),d=k(()=>e.selectedIndex!==null),m=k(()=>d.value?e.selectedIndex:o.value);function n(u){var t;let a=q(p.tabs.value,_),$=q(p.panels.value,_),B=a.filter(P=>{var C;return!((C=_(P))!=null&&C.hasAttribute("disabled"))});if(u<0||u>a.length-1){let P=Y(o.value===null?0:Math.sign(u-o.value),{[-1]:()=>1,0:()=>Y(Math.sign(u),{[-1]:()=>0,0:()=>0,1:()=>1}),1:()=>0}),C=Y(P,{0:()=>a.indexOf(B[0]),1:()=>a.indexOf(B[B.length-1])});C!==-1&&(o.value=C),p.tabs.value=a,p.panels.value=$}else{let P=a.slice(0,u),C=[...a.slice(u),...P].find($e=>B.includes($e));if(!C)return;let Z=(t=a.indexOf(C))!=null?t:p.selectedIndex.value;Z===-1&&(Z=p.selectedIndex.value),o.value=Z,p.tabs.value=a,p.panels.value=$}}let p={selectedIndex:k(()=>{var u,t;return(t=(u=o.value)!=null?u:e.defaultIndex)!=null?t:null}),orientation:k(()=>e.vertical?"vertical":"horizontal"),activation:k(()=>e.manual?"manual":"auto"),tabs:l,panels:h,setSelectedIndex(u){m.value!==u&&f("change",u),d.value||n(u)},registerTab(u){var t;if(l.value.includes(u))return;let a=l.value[o.value];l.value.push(u),l.value=q(l.value,_);let $=(t=l.value.indexOf(a))!=null?t:o.value;$!==-1&&(o.value=$)},unregisterTab(u){let t=l.value.indexOf(u);t!==-1&&l.value.splice(t,1)},registerPanel(u){h.value.includes(u)||(h.value.push(u),h.value=q(h.value,_))},unregisterPanel(u){let t=h.value.indexOf(u);t!==-1&&h.value.splice(t,1)}};se(ye,p);let r=x({tabs:[],panels:[]}),I=x(!1);U(()=>{I.value=!0}),se(te,k(()=>I.value?null:r.value));let T=k(()=>e.selectedIndex);return U(()=>{xe([T],()=>{var u;return n((u=e.selectedIndex)!=null?u:e.defaultIndex)},{immediate:!0})}),me(()=>{if(!d.value||m.value==null||p.tabs.value.length<=0)return;let u=q(p.tabs.value,_);u.some((t,a)=>_(p.tabs.value[a])!==_(t))&&p.setSelectedIndex(u.findIndex(t=>_(t)===_(p.tabs.value[m.value])))}),()=>{let u={selectedIndex:o.value};return W(M,[l.value.length<=0&&W(Ie,{onFocus:()=>{for(let t of l.value){let a=_(t);if((a==null?void 0:a.tabIndex)===0)return a.focus(),!0}return!1}}),J({theirProps:{...c,...Ae(e,["selectedIndex","defaultIndex","manual","vertical","onChange"])},ourProps:{},slot:u,slots:v,attrs:c,name:"TabGroup"})])}}}),Ne=N({name:"TabList",props:{as:{type:[Object,String],default:"div"}},setup(e,{attrs:v,slots:c}){let f=X("TabList");return()=>{let i={selectedIndex:f.selectedIndex.value},o={role:"tablist","aria-orientation":f.orientation.value};return J({ourProps:o,theirProps:e,slot:i,attrs:v,slots:c,name:"TabList"})}}}),be=N({name:"Tab",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1},id:{type:String,default:()=>`headlessui-tabs-tab-${_e()}`}},setup(e,{attrs:v,slots:c,expose:f}){let i=X("Tab"),o=x(null);f({el:o,$el:o}),U(()=>i.registerTab(o)),he(()=>i.unregisterTab(o));let l=ee(te),h=k(()=>{if(l.value){let t=l.value.tabs.indexOf(e.id);return t===-1?l.value.tabs.push(e.id)-1:t}return-1}),d=k(()=>{let t=i.tabs.value.indexOf(o);return t===-1?h.value:t}),m=k(()=>d.value===i.selectedIndex.value);function n(t){var a;let $=t();if($===V.Success&&i.activation.value==="auto"){let B=(a=Te(o))==null?void 0:a.activeElement,P=i.tabs.value.findIndex(C=>_(C)===B);P!==-1&&i.setSelectedIndex(P)}return $}function p(t){let a=i.tabs.value.map($=>_($)).filter(Boolean);if(t.key===L.Space||t.key===L.Enter){t.preventDefault(),t.stopPropagation(),i.setSelectedIndex(d.value);return}switch(t.key){case L.Home:case L.PageUp:return t.preventDefault(),t.stopPropagation(),n(()=>j(a,D.First));case L.End:case L.PageDown:return t.preventDefault(),t.stopPropagation(),n(()=>j(a,D.Last))}if(n(()=>Y(i.orientation.value,{vertical(){return t.key===L.ArrowUp?j(a,D.Previous|D.WrapAround):t.key===L.ArrowDown?j(a,D.Next|D.WrapAround):V.Error},horizontal(){return t.key===L.ArrowLeft?j(a,D.Previous|D.WrapAround):t.key===L.ArrowRight?j(a,D.Next|D.WrapAround):V.Error}}))===V.Success)return t.preventDefault()}let r=x(!1);function I(){var t;r.value||(r.value=!0,!e.disabled&&((t=_(o))==null||t.focus({preventScroll:!0}),i.setSelectedIndex(d.value),ke(()=>{r.value=!1})))}function T(t){t.preventDefault()}let u=Pe(k(()=>({as:e.as,type:v.type})),o);return()=>{var t;let a={selected:m.value},{id:$,...B}=e,P={ref:o,onKeydown:p,onMousedown:T,onClick:I,id:$,role:"tab",type:u.value,"aria-controls":(t=_(i.panels.value[d.value]))==null?void 0:t.id,"aria-selected":m.value,tabIndex:m.value?0:-1,disabled:e.disabled?!0:void 0};return J({ourProps:P,theirProps:B,slot:a,attrs:v,slots:c,name:"Tab"})}}}),H=N({name:"TabPanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:()=>`headlessui-tabs-panel-${_e()}`},tabIndex:{type:Number,default:0}},setup(e,{attrs:v,slots:c,expose:f}){let i=X("TabPanel"),o=x(null);f({el:o,$el:o}),U(()=>i.registerPanel(o)),he(()=>i.unregisterPanel(o));let l=ee(te),h=k(()=>{if(l.value){let n=l.value.panels.indexOf(e.id);return n===-1?l.value.panels.push(e.id)-1:n}return-1}),d=k(()=>{let n=i.panels.value.indexOf(o);return n===-1?h.value:n}),m=k(()=>d.value===i.selectedIndex.value);return()=>{var n;let p={selected:m.value},{id:r,tabIndex:I,...T}=e,u={ref:o,id:r,role:"tabpanel","aria-labelledby":(n=_(i.tabs.value[d.value]))==null?void 0:n.id,tabIndex:m.value?I:-1};return!m.value&&e.unmount&&!e.static?W(ge,{as:"span",...u}):J({ourProps:u,theirProps:T,slot:p,attrs:v,slots:c,features:ne.Static|ne.RenderStrategy,visible:m.value,name:"TabPanel"})}}});const Oe={class:"grid grid-flow-col space-x-4"},je={class:"w-full h-48 object-cover rounded-lg"},Re={class:"text-xl font-semibold mb-2"},Fe={class:"text-sm mb-2"},Ue=s("strong",null,"Id:",-1),qe={class:"text-sm mb-2"},Ge=s("strong",null,"Variety:",-1),Me={class:"text-sm mb-2"},Ve=s("strong",null,"Yield Tonnage:",-1),He={class:"text-sm mb-2"},Ye=s("strong",null,"Expected Harvest Date:",-1),We={class:"text-sm mb-2"},ze=s("strong",null,"Price:",-1),Ke={class:"text-sm mb-2"},Je=s("strong",null,"bidding End time:",-1),Qe={class:"flex justify-end mt-2 space-x-4"},Xe=["onClick"],Ze=["onClick"],et=N({__name:"SellerContentComponent",props:{ads:{type:Array,required:!0}},emits:["edit"],setup(e,{emit:v}){const c=Ce(),f=v,i=x(!1),o=async n=>{n&&(i.value=!0,await O().postNewAd(n),i.value=!1)},l=x(""),h=async n=>{n&&(l.value=n,console.log("removeAd",n),await O().removeUserAd(n),l.value="")},d=n=>{n&&f("edit",n)},m=n=>{n&&c.push({name:"ad",params:{adId:n}})};return(n,p)=>(g(),w("span",Oe,[(g(!0),w(M,null,Q(e.ads,(r,I)=>(g(),w("div",{key:I,class:"bg-white p-4 rounded-lg shadow-md hover:shadow-lg transition duration-300"},[s("div",je,[S(Ee,{images:r.resizedImages},null,8,["images"])]),s("h3",Re,y(r.type),1),s("p",Fe,[Ue,A(" "+y(r.id),1)]),s("p",qe,[Ge,A(" "+y(r.variety),1)]),s("p",Me,[Ve,A(" "+y(r.yieldTonnage),1)]),s("p",He,[Ye,A(" "+y(b(z)(r.expectedHarvestDate)?b(K)(r.expectedHarvestDate):r.expectedHarvestDate),1)]),s("p",We,[ze,A(" "+y(r.price),1)]),s("p",Ke,[Je,A(" "+y(b(z)(r.biddingEndTime)?b(K)(r.biddingEndTime):r.biddingEndTime),1)]),s("div",Qe,[s("button",{onClick:T=>d(r.id),class:"inline-flex justify-center rounded-md border border-transparent bg-green-100 px-4 py-2 text-sm font-medium text-green-900 hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"}," Edit ",8,Xe),r.live?F("",!0):(g(),R(G,{key:0,disabled:r.live,isLoading:i.value,onClick:T=>o(r.id),class:"inline-flex justify-center rounded-md border border-transparent bg-green-100 px-4 py-2 text-sm font-medium text-green-900 hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"},{default:E(()=>[A(" Post ")]),_:2},1032,["disabled","isLoading","onClick"])),s("button",{onClick:T=>m(r.id),class:"inline-flex justify-center rounded-md border border-transparent bg-green-100 px-4 py-2 text-sm font-medium text-green-900 hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"}," View ",8,Ze),S(G,{disabled:r.live,isLoading:l.value==r.id,onClick:T=>h(r.id),class:"inline-flex justify-center rounded-md border border-transparent bg-red-100 px-4 py-2 text-sm font-medium text-green-900 hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"},{default:E(()=>[A(" Remove ")]),_:2},1032,["disabled","isLoading","onClick"])])]))),128))]))}}),tt={class:"text-xl font-semibold mb-2"},st={class:"text-sm mb-2"},nt=s("strong",null,"Id:",-1),lt={class:"text-sm mb-2"},at=s("strong",null,"Yield Tonnage:",-1),ot={class:"text-sm mb-2"},it=s("strong",null,"Request Date:",-1),ut={class:"text-sm mb-2"},rt=s("strong",null,"Price:",-1),dt={class:"flex justify-end mt-2 space-x-4"},ct=["onClick"],vt=N({__name:"BuyerContentComponent",props:{ads:{type:Array,required:!0}},emits:["edit"],setup(e,{emit:v}){const c=v,f=x(!1),i=async d=>{d&&(f.value=!0,await O().postNewAd(d),f.value=!1)},o=x(""),l=async d=>{d&&(o.value=d,O().removeUserAd(d),o.value="")},h=d=>{d&&c("edit",d)};return(d,m)=>(g(),w("span",null,[(g(!0),w(M,null,Q(e.ads,(n,p)=>(g(),w("div",{key:p,class:"bg-white p-4 rounded-lg shadow-md hover:shadow-lg transition duration-300"},[s("h3",tt,y(n.type),1),s("p",st,[nt,A(" "+y(n.id),1)]),s("p",lt,[at,A(" "+y(n.yieldTonnage),1)]),s("p",ot,[it,A(" "+y(n.requestDate),1)]),s("p",ut,[rt,A(" "+y(n.price),1)]),s("div",dt,[s("button",{onClick:r=>h(n.id),class:"inline-flex justify-center rounded-md border border-transparent bg-green-100 px-4 py-2 text-sm font-medium text-green-900 hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"}," Edit ",8,ct),S(G,{isLoading:f.value,disabled:n.live,onClick:r=>i(n.id),class:"inline-flex justify-center rounded-md border border-transparent bg-green-100 px-4 py-2 text-sm font-medium text-green-900 hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"},{default:E(()=>[A(" Post ")]),_:2},1032,["isLoading","disabled","onClick"]),S(G,{isLoading:o.value==n.id,disabled:!n.live,onClick:r=>l(n.id),class:"inline-flex justify-center rounded-md border border-transparent bg-red-100 px-4 py-2 text-sm font-medium text-green-900 hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"},{default:E(()=>[A(" Remove ")]),_:2},1032,["isLoading","disabled","onClick"])])]))),128))]))}}),ft={class:"grid grid-flow-row space-y-4"},pt={class:"bg-white p-4 rounded-lg shadow-md hover:shadow-lg transition duration-300 mb-4"},bt={class:"flex flex-row"},mt={class:"flex flex-row space-x-4"},gt=s("label",{class:"block text-sm font-medium text-gray-700"},"Buyer",-1),xt={class:"text-sm"},_t={class:"flex flex-row space-x-4"},ht=s("label",{class:"block text-sm font-medium text-gray-700"},"Offer",-1),yt={class:"text-sm"},$t={class:"flex flex-row space-x-4"},wt=s("label",{class:"block text-sm font-medium text-gray-700"},"Time",-1),At={class:"text-sm"},kt={class:"flex flex-row space-x-4"},Tt=s("label",{class:"block text-sm font-medium text-gray-700"},"Status",-1),Ct={class:"text-sm"},St={class:"flex flex-row space-x-4"},Et=s("label",{class:"block text-sm font-medium text-gray-700"},"Last updated",-1),Pt={class:"text-sm"},It={class:"flex justify-end"},Bt=N({__name:"BidContentComponent",props:{bids:{type:Array,required:!0}},setup(e){const v=O().BID_STATUSES,c=x(""),f=async i=>{console.log("Cancelling bid",i),c.value=i,await O().cancelUserBid(i),c.value=""};return(i,o)=>(g(),w("span",ft,[(g(!0),w(M,null,Q(e.bids,l=>(g(),w("div",pt,[s("div",bt,[s("span",null,[s("div",mt,[gt,s("p",xt,y(l.buyerId.substring(0,5)),1)]),s("div",_t,[ht,s("p",yt,y(l.price),1)]),s("div",$t,[wt,s("p",At,y(b(z)(l.createdAt)?b(K)(l.createdAt):l.createdAt),1)])]),s("span",null,[s("div",kt,[Tt,s("p",Ct,y(l.status),1)]),s("div",St,[Et,s("p",Pt,y(b(z)(l.updatedAt)?b(K)(l.updatedAt):l.updatedAt),1)])])]),s("div",It,[l.status===b(v).PENDING?(g(),R(G,{key:0,isLoading:c.value==l.id,onClick:h=>f(l.id),class:"mt-2 mb-2 inline-flex justify-center rounded-md border border-transparent bg-blue-100 px-4 py-2 text-sm font-medium text-blue-900 hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"},{default:E(()=>[A("Cancel Bid")]),_:2},1032,["isLoading","onClick"])):F("",!0)])]))),256))]))}}),Lt={class:"w-full px-2 py-3 sm:px-0"},Dt={key:0,class:"w-full"},Nt={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Ot={key:1},jt={key:2},Rt=s("div",null,"No ads found",-1),Ft=[Rt],Ut={key:1},qt={key:2},Gt=s("p",null,"No bids yet",-1),Mt=[Gt],Yt=N({__name:"UserBoardView",setup(e){const{profile:v,user:c}=le(O()),{modals:f}=le(Se()),i=O().ACCOUNT_TYPES,o=()=>{f.value.addad=!0},l=x(0),h={ADS:"Ads",CONTRACTS:"Contracts",MESSAGES:"Messages"},d=x([]),m=x([]),n=x(!1),p=async()=>{n.value=!0,d.value=await ae("ads","uid","==",c.value.uid,["createdAt","desc"],10),console.log("ads",d.value),T=oe(ie(de(fe,"ads"),re("uid","==",c.value.uid),ue("createdAt","desc")),t=>{d.value.docs=t.docs.map(a=>(console.log("ads changed"),{id:a.id,...a.data()}))}),n.value=!1},r=x(!1),I=async()=>{r.value=!0,m.value=await ae("bids","buyerId","==",c.value.uid,["createdAt","desc"],10),console.log("loadingBids",m.value),T=oe(ie(de(fe,"bids"),re("buyerId","==",c.value.uid),ue("createdAt","desc")),t=>{m.value.docs=t.docs.map(a=>(console.log("bids changed"),{id:a.id,...a.data()}))}),r.value=!1};let T;xe(l,async(t,a)=>{l.value==0&&await p(),l.value==3&&await I(),(a==3||a==0)&&T()}),U(async()=>{console.log("mounted"),await p()});const u=async t=>{console.log("removeAd",t),f.value.editad=!0,f.value.context=d.value.docs.find(a=>a.id===t)};return(t,a)=>(g(),w("div",Lt,[b(v)?(g(),w("div",Dt,[S(b(De),{class:"w-full",as:"div"},{default:E(()=>[S(b(Ne),{class:"w-full flex space-x-1 rounded-xl bg-blue-900/20 p-1"},{default:E(()=>[(g(),w(M,null,Q(h,($,B,P)=>S(b(be),{as:"template",key:B,onClick:C=>l.value=P},{default:E(({selected:C})=>[s("button",{class:ce(["w-full rounded-lg py-2.5 text-sm font-medium leading-5 text-blue-700","ring-white/60 ring-offset-2 ring-offset-blue-400 focus:outline-none focus:ring-2",C?"bg-white shadow":"text-blue-100 hover:bg-white/[0.12] hover:text-white"])},y($),3)]),_:2},1032,["onClick"])),64)),b(v).accountType===b(i).BUYER?(g(),R(b(be),{key:0,as:"template",onClick:a[0]||(a[0]=$=>l.value=3)},{default:E(({selected:$})=>[s("button",{class:ce(["w-full rounded-lg py-2.5 text-sm font-medium leading-5 text-blue-700","ring-white/60 ring-offset-2 ring-offset-blue-400 focus:outline-none focus:ring-2",$?"bg-white shadow":"text-blue-100 hover:bg-white/[0.12] hover:text-white"])}," Bids ",2)]),_:1})):F("",!0)]),_:1}),S(b(H),null,{default:E(()=>[s("button",{onClick:o,class:"mt-2 mb-2 w-full inline-flex justify-center rounded-md border border-transparent bg-blue-100 px-4 py-2 text-sm font-medium text-blue-900 hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"},"Add an ad"),d.value.docs&&d.value.docs.length>0&&!n.value?(g(),w("div",Nt,[b(v).accountType==b(i).SELLER?(g(),R(et,{key:0,ads:d.value.docs?d.value.docs:[],onEdit:u},null,8,["ads"])):F("",!0),b(v).accountType==b(i).BUYER?(g(),R(vt,{key:1,ads:d.value.docs?d.value.docs:[],onEdit:u},null,8,["ads"])):F("",!0)])):n.value?(g(),w("div",Ot,[S(ve,{isLoading:n.value},null,8,["isLoading"])])):(g(),w("div",jt,Ft))]),_:1}),S(b(H),null,{default:E(()=>[A(" Contract ")]),_:1}),S(b(H),null,{default:E(()=>[A(" Messages ")]),_:1}),S(b(H),null,{default:E(()=>[m.value.docs&&m.value.docs.length>0&&!r.value?(g(),R(Bt,{key:0,bids:m.value.docs?m.value.docs:[]},null,8,["bids"])):r.value?(g(),w("div",Ut,[S(ve,{isLoading:r.value},null,8,["isLoading"])])):(g(),w("span",qt,Mt))]),_:1})]),_:1})])):F("",!0)]))}});export{Yt as default};
