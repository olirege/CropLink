import{d as Y,s as w,x as W,a as f,h as r,o as z,c as Q,e as s,f as d,l as L,y as h,q as y,m as B,_ as j,p as l,t as H,F as C,k as J,n as K,L as X,g as E,P as Z,M as D,z as T,Q as S,R as P,S as c,T as A,U as ee,i as $,B as b}from"./index-77675d52.js";import{_ as ae}from"./SellerAdCard.vue_vue_type_script_setup_true_lang-c1f27fd2.js";import{_ as te}from"./BidCard.vue_vue_type_script_setup_true_lang-0c8291d6.js";import"./ImageCarousel-86bf2d28.js";const se={key:0,class:"grid grid-cols-2 gap-x-4 p-5"},oe={key:0},de={key:1},ne={key:2},le=E("p",null,"No bids yet",-1),ie=[le],ue={key:3},re={key:1},ce=E("p",null,"Ad not live yet",-1),ve={key:1},ge=Y({__name:"AdView",props:{adId:{type:String,required:!0}},setup(M){const{modals:N}=w(W()),{profile:U}=w(f()),x=f().ACCOUNT_TYPES,m=f().AD_STATUSES,i=M,o=r([]),e=r({}),u=r(!1);let v;const V=async()=>{u.value=!0,e.value=await Z("ads",i.adId),e.value&&(e.value.live||e.value.status!=m.SOLD?(o.value=await D("bids","adId","==",i.adId,"status","==","pending",["createdAt","desc"],10),v=T(S(A(b,"bids"),c("adId","==",i.adId),c("status","==","pending"),P("createdAt","desc")),t=>{o.value=t.docs.map(a=>({id:a.id,...a.data()}))})):!e.value.live&&e.value.status==m.SOLD?(o.value=await D("bids","adId","==",i.adId,"status","==","accepted",["createdAt","desc"],10),v=T(S(A(b,"bids"),c("adId","==",i.adId),c("status","==","accepted"),P("createdAt","desc")),t=>{o.value=t.docs.map(a=>({id:a.id,...a.data()}))})):v=T(S(A(b,"ads"),c("id","==",i.adId)),t=>{e.value=t.docs.map(a=>(console.log("ad changed",a.data()),{...a.data()}))}),u.value=!1)},_=r(""),k=()=>{if(!e.value.biddingEndTime)return"";const t=ee(e.value.biddingEndTime),a=Date.now(),n=t-a;if(n<0){_.value="Bidding has ended",clearInterval(I);return}let p=Math.floor(n/1e3%60),F=Math.floor(n/(1e3*60)%60),G=Math.floor(n/(1e3*60*60)%24),R=Math.floor(n/(1e3*60*60*24));_.value=`${R} days ${G} hours ${F} minutes ${p} seconds`},I=setInterval(k,1e3),O=()=>{N.value.addbid=!0};z(async()=>{await V(),k()}),Q(()=>{v(),clearInterval(I)});const g=r(!1),q=async t=>{t&&(g.value=!0,console.log("postAd",t),await f().postNewAd(t),g.value=!1)};return(t,a)=>{var n;return s(),d(C,null,[e.value&&!u.value?(s(),d("div",se,[L(ae,{ad:e.value,showButtons:!1},null,8,["ad"]),e.value.live||e.value.status==h(m).SOLD?(s(),d("div",oe,[((n=h(U))==null?void 0:n.accountType)==h(x).BUYER?(s(),y(j,{key:0,onClick:O},{default:B(()=>[$("Place a bid")]),_:1})):l("",!0),_.value?(s(),d("div",de," Time left for bidding: "+H(_.value),1)):l("",!0),!o.value||o.value.length==0?(s(),d("span",ne,ie)):l("",!0),o.value&&o.value.length>0?(s(),d("span",ue,[(s(!0),d(C,null,J(o.value,p=>(s(),y(te,{bid:p,showViewButton:!1,sellerId:e.value.uid},null,8,["bid","sellerId"]))),256))])):l("",!0)])):(s(),d("div",re,[ce,e.value.live?l("",!0):(s(),y(K,{key:0,disabled:e.value.live,isLoading:g.value,onClick:a[0]||(a[0]=p=>q(e.value.id))},{default:B(()=>[$(" Post ")]),_:1},8,["disabled","isLoading"]))]))])):l("",!0),u.value?(s(),d("div",ve,[L(X,{isLoading:u.value},null,8,["isLoading"])])):l("",!0)],64)}}});export{ge as default};
